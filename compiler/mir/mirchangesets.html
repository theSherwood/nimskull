<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>compiler/mir/mirchangesets</title>
<link rel="stylesheet" type="text/css" href="../nimdoc.out.css">

<script type="text/javascript" src="../dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  if (toggleSwitch !== null) {
    toggleSwitch.addEventListener('change', switchTheme, false);
  }

  var currentTheme = localStorage.getItem('theme');
  if (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    currentTheme = 'dark';
  }
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark' && toggleSwitch !== null) {
      toggleSwitch.checked = true;
    }
  }
}

window.addEventListener('DOMContentLoaded', main);
</script>

</head>
<body>
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">compiler/mir/mirchangesets</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple-boot">
      <li><a href="manual.html">Manual</a></li>
      <li><a href="style_guide.html">Style guide</a></li>
      <li><a href="contributing.html">Contribution guide</a></li>
      <li><a href="lib.html">Standard library</a></li>
      <li><a href="../theindex.html">Index</a></li>
      <li><a href="compiler/../theindex.html">Compiler docs</a></li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
  
  <ul class="simple simple-toc" id="toc-list">
<li><a class="reference" id="order-of-application_toc" href="#order-of-application">Order of application</a></li>
<li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#7" id="57">Types</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#Changeset"
    title="Changeset = object
  tree: MirTree ## stored in the changeset so that it's not required to pass the tree to
                ## each ``Changeset`` routine
  nodes: seq[MirNode]
  rows: seq[Row]
  numTemps: uint32           ## the number of existing temporaries
  pos: NodePosition          ## the cursor position">Changeset</a></li>
  <li><a class="reference" href="#PreparedChangeset"
    title="PreparedChangeset = object
  nodes: seq[MirNode]
  rows: seq[Row]
  diff: int                  ## the number of additions/removals
  stagingSize: int ## the minimum amount of nodes the working area must be
                   ## able to hold">PreparedChangeset</a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">apply
      <li><a class="reference" href="#apply%2CMirTree%2CsinkPreparedChangeset"
    title="apply(tree: var MirTree; c: sink PreparedChangeset)">apply(tree: var MirTree; c: sink PreparedChangeset)</a></li>

  </ul>
  <ul class="simple nested-toc-section">getTemp
      <li><a class="reference" href="#getTemp%2CChangeset"
    title="getTemp(c: var Changeset): TempId">getTemp(c: var Changeset): TempId</a></li>

  </ul>
  <ul class="simple nested-toc-section">initChangeset
      <li><a class="reference" href="#initChangeset%2CMirTree"
    title="initChangeset(tree: MirTree): Changeset">initChangeset(tree: MirTree): Changeset</a></li>

  </ul>
  <ul class="simple nested-toc-section">insert
      <li><a class="reference" href="#insert%2CChangeset%2CsinkMirNode%2CNodeInstance"
    title="insert(c: var Changeset; n: sink MirNode; source: NodeInstance)">insert(c: var Changeset; n: sink MirNode; source: NodeInstance)</a></li>

  </ul>
  <ul class="simple nested-toc-section">prepare
      <li><a class="reference" href="#prepare%2CsinkChangeset%2CSourceMap"
    title="prepare(c: sink Changeset; sourceMap: SourceMap): PreparedChangeset">prepare(c: sink Changeset; sourceMap: SourceMap): PreparedChangeset</a></li>

  </ul>
  <ul class="simple nested-toc-section">remove
      <li><a class="reference" href="#remove%2CChangeset"
    title="remove(c: var Changeset)">remove(c: var Changeset)</a></li>

  </ul>
  <ul class="simple nested-toc-section">replace
      <li><a class="reference" href="#replace%2CChangeset%2CsinkMirNode"
    title="replace(c: var Changeset; n: sink MirNode)">replace(c: var Changeset; n: sink MirNode)</a></li>

  </ul>
  <ul class="simple nested-toc-section">seek
      <li><a class="reference" href="#seek%2CChangeset%2CNodePosition"
    title="seek(c: var Changeset; dest: NodePosition)">seek(c: var Changeset; dest: NodePosition)</a></li>

  </ul>
  <ul class="simple nested-toc-section">skip
      <li><a class="reference" href="#skip%2CChangeset%2CNatural"
    title="skip(c: var Changeset; num: Natural)">skip(c: var Changeset; num: Natural)</a></li>

  </ul>
  <ul class="simple nested-toc-section">updateSourceMap
      <li><a class="reference" href="#updateSourceMap%2CSourceMap%2CPreparedChangeset"
    title="updateSourceMap(m: var SourceMap; c: PreparedChangeset)">updateSourceMap(m: var SourceMap; c: PreparedChangeset)</a></li>

  </ul>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#18" id="68">Templates</a>
  <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">insert
      <li><a class="reference" href="#insert.t%2CChangeset%2CNodeInstance%2Cuntyped%2Cuntyped"
    title="insert(c: var Changeset; source: NodeInstance; name: untyped; body: untyped)">insert(c: var Changeset; source: NodeInstance; name: untyped; body: untyped)</a></li>

  </ul>
  <ul class="simple nested-toc-section">position
      <li><a class="reference" href="#position.t%2CChangeset"
    title="position(cs: Changeset): NodePosition">position(cs: Changeset): NodePosition</a></li>

  </ul>
  <ul class="simple nested-toc-section">replaceMulti
      <li><a class="reference" href="#replaceMulti.t%2CChangeset%2Cuntyped%2Cuntyped"
    title="replaceMulti(c: var Changeset; name, body: untyped)">replaceMulti(c: var Changeset; name, body: untyped)</a></li>

  </ul>

  </ul>
</li>

</ul>

  </div>
  &nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L1"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L1" class="link-seesrc" target="_blank" >Edit</a>

  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"><p>This module implements the <tt class="docutils literal"><span class="pre">Changeset</span></tt> API, which is the main way of applying changes to a <tt class="docutils literal"><span class="pre">MirTree</span></tt>.</p>
<p>Instead of modifying a <tt class="docutils literal"><span class="pre">MirTree</span></tt> directly, the changes (which can be insertions, replacements, or removals) are first recorded into a <tt class="docutils literal"><span class="pre">Changeset</span></tt>. This allows for recording changes independent of each other concurrently and later apply the changes all at once.</p>
<p>A cursor-like API is used. One has to first move the <tt class="docutils literal"><span class="pre">Changeset</span></tt> to the position that the to-be-recorded change applies to via <tt class="docutils literal"><span class="pre">seek</span></tt>.</p>
<p>Before applying a <tt class="docutils literal"><span class="pre">Changeset</span></tt> to a <tt class="docutils literal"><span class="pre">MirTree</span></tt>, it has to be prepared via a call to <tt class="docutils literal"><span class="pre">prepare</span></tt> first, after which the <tt class="docutils literal"><span class="pre">Changeset</span></tt> is sealed an no further changes can be recorded. <tt class="docutils literal"><span class="pre">prepare</span></tt> is responsible from normalizing the internal representation of the <tt class="docutils literal"><span class="pre">Changeset</span></tt> and is required for the later application to work.</p>
<p>Applying the <tt class="docutils literal"><span class="pre">PreparedChangeset</span></tt> is done via <tt class="docutils literal"><span class="pre">apply</span></tt> -- updating the <tt class="docutils literal"><span class="pre">MirTree</span></tt>'s corresponding <tt class="docutils literal"><span class="pre">SourceMap</span></tt> via <tt class="docutils literal"><span class="pre">updateSourceMap</span></tt>. For efficiency, <tt class="docutils literal"><span class="pre">apply</span></tt> consumes the changeset, so it is advised to call <tt class="docutils literal"><span class="pre">updateSourceMap</span></tt> first.</p>

<h1><a class="toc-backref" id="order-of-application" href="#order-of-application">Order of application</a></h1><p>Nodes are inserted <em>before</em> the node at the insertion position, meaning that it is allowed for an insertion to overlap with a removal/replacement at the <em>start</em> position. All other forms of overlapping changes are disallowed. If there exist two or more insertion at the same position, they are applied in the order the changes were recorded. That is, the nodes from the insertion recorded first are inserted first, then that of the second recorded, then the third one's, etc.</p>
</p>
  <div class="section" id="6">
<h1><a class="toc-backref" href="#6">Imports</a></h1>
<dl class="item">
<a class="reference external" href="mirtrees.html">mirtrees</a>, <a class="reference external" href="sourcemaps.html">sourcemaps</a>, <a class="reference external" href="../utils/idioms.html">../utils/idioms</a>
</dl></div>
<div class="section" id="7">
<h1><a class="toc-backref" href="#7">Types</a></h1>
<dl class="item">
<div id="Changeset">
<dt><pre><a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a> <span class="Other">=</span> <span class="Keyword">object</span>
  <span class="Identifier">tree</span><span class="Other">:</span> <a href="mirtrees.html#MirTree"><span class="Identifier">MirTree</span></a> <span class="Comment">## stored in the changeset so that it's not required to pass the tree to</span>
                <span class="Comment">## each ``Changeset`` routine</span>
  <span class="Identifier">nodes</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><a href="mirtrees.html#MirNode"><span class="Identifier">MirNode</span></a><span class="Other">]</span>
  <span class="Identifier">rows</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">Row</span><span class="Other">]</span>
  <span class="Identifier">numTemps</span><span class="Other">:</span> <span class="Identifier">uint32</span>           <span class="Comment">## the number of existing temporaries</span>
  <span class="Identifier">pos</span><span class="Other">:</span> <a href="mirtrees.html#NodePosition"><span class="Identifier">NodePosition</span></a>          <span class="Comment">## the cursor position</span>
  </pre></dt>
<dd>


&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L62"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L62" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="PreparedChangeset">
<dt><pre><a href="mirchangesets.html#PreparedChangeset"><span class="Identifier">PreparedChangeset</span></a> <span class="Other">=</span> <span class="Keyword">object</span>
  <span class="Identifier">nodes</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><a href="mirtrees.html#MirNode"><span class="Identifier">MirNode</span></a><span class="Other">]</span>
  <span class="Identifier">rows</span><span class="Other">:</span> <span class="Identifier">seq</span><span class="Other">[</span><span class="Identifier">Row</span><span class="Other">]</span>
  <span class="Identifier">diff</span><span class="Other">:</span> <span class="Identifier">int</span>                  <span class="Comment">## the number of additions/removals</span>
  <span class="Identifier">stagingSize</span><span class="Other">:</span> <span class="Identifier">int</span> <span class="Comment">## the minimum amount of nodes the working area must be</span>
                   <span class="Comment">## able to hold</span>
  </pre></dt>
<dd>


&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L82"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L82" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">
<div id="apply,MirTree,sinkPreparedChangeset">
<dt><pre><span class="Keyword">func</span> <a href="#apply%2CMirTree%2CsinkPreparedChangeset"><span class="Identifier">apply</span></a><span class="Other">(</span><span class="Identifier">tree</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="mirtrees.html#MirTree"><span class="Identifier">MirTree</span></a><span class="Other">;</span> <span class="Identifier">c</span><span class="Other">:</span> <span class="Identifier">sink</span> <a href="mirchangesets.html#PreparedChangeset"><span class="Identifier">PreparedChangeset</span></a><span class="Other">)</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Applies the changeset <tt class="docutils literal"><span class="pre"><span class="Identifier">c</span></span></tt> to the <tt class="docutils literal"><span class="pre"><span class="Identifier">tree</span></span></tt>, modifying the tree in-place. The tree's underlying sequence is resized 0 to 2 times.
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L312"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L312" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="getTemp,Changeset">
<dt><pre><span class="Keyword">func</span> <a href="#getTemp%2CChangeset"><span class="Identifier">getTemp</span></a><span class="Other">(</span><span class="Identifier">c</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a><span class="Other">)</span><span class="Other">:</span> <a href="mirtrees.html#TempId"><span class="Identifier">TempId</span></a> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Allocates a slot for new temporary and returns its ID
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L122"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L122" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="initChangeset,MirTree">
<dt><pre><span class="Keyword">func</span> <a href="#initChangeset%2CMirTree"><span class="Identifier">initChangeset</span></a><span class="Other">(</span><span class="Identifier">tree</span><span class="Other">:</span> <a href="mirtrees.html#MirTree"><span class="Identifier">MirTree</span></a><span class="Other">)</span><span class="Other">:</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Initializes a new <tt class="docutils literal"><span class="pre">Changeset</span></tt> instance. Until the resulting <tt class="docutils literal"><span class="pre">Changeset</span></tt> is applied, the associated tree must not be modified
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L111"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L111" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="insert,Changeset,sinkMirNode,NodeInstance">
<dt><pre><span class="Keyword">func</span> <a href="#insert%2CChangeset%2CsinkMirNode%2CNodeInstance"><span class="Identifier">insert</span></a><span class="Other">(</span><span class="Identifier">c</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a><span class="Other">;</span> <span class="Identifier">n</span><span class="Other">:</span> <span class="Identifier">sink</span> <a href="mirtrees.html#MirNode"><span class="Identifier">MirNode</span></a><span class="Other">;</span> <span class="Identifier">source</span><span class="Other">:</span> <a href="mirtrees.html#NodeInstance"><span class="Identifier">NodeInstance</span></a><span class="Other">)</span> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Inserts <tt class="docutils literal"><span class="pre"><span class="Identifier">n</span></span></tt> at the current cursor position, using <tt class="docutils literal"><span class="pre"><span class="Identifier">source</span></span></tt> as the inserted node's origin
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L144"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L144" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="prepare,sinkChangeset,SourceMap">
<dt><pre><span class="Keyword">func</span> <a href="#prepare%2CsinkChangeset%2CSourceMap"><span class="Identifier">prepare</span></a><span class="Other">(</span><span class="Identifier">c</span><span class="Other">:</span> <span class="Identifier">sink</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a><span class="Other">;</span> <span class="Identifier">sourceMap</span><span class="Other">:</span> <a href="sourcemaps.html#SourceMap"><span class="Identifier">SourceMap</span></a><span class="Other">)</span><span class="Other">:</span> <a href="mirchangesets.html#PreparedChangeset"><span class="Identifier">PreparedChangeset</span></a> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Prepares <tt class="docutils literal"><span class="pre"><span class="Identifier">c</span></span></tt> for being applied
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L198"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L198" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="remove,Changeset">
<dt><pre><span class="Keyword">func</span> <a href="#remove%2CChangeset"><span class="Identifier">remove</span></a><span class="Other">(</span><span class="Identifier">c</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a><span class="Other">)</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Records the removal of the currently pointed to sub-tree
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L186"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L186" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="replace,Changeset,sinkMirNode">
<dt><pre><span class="Keyword">func</span> <a href="#replace%2CChangeset%2CsinkMirNode"><span class="Identifier">replace</span></a><span class="Other">(</span><span class="Identifier">c</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a><span class="Other">;</span> <span class="Identifier">n</span><span class="Other">:</span> <span class="Identifier">sink</span> <a href="mirtrees.html#MirNode"><span class="Identifier">MirNode</span></a><span class="Other">)</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Records a change that replaces the node at the current cursor position with <tt class="docutils literal"><span class="pre"><span class="Identifier">n</span></span></tt>, inheriting it origin information. If the cursor points to a sub-tree, the whole sub-tree is replaced
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L136"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L136" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="seek,Changeset,NodePosition">
<dt><pre><span class="Keyword">func</span> <a href="#seek%2CChangeset%2CNodePosition"><span class="Identifier">seek</span></a><span class="Other">(</span><span class="Identifier">c</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a><span class="Other">;</span> <span class="Identifier">dest</span><span class="Other">:</span> <a href="mirtrees.html#NodePosition"><span class="Identifier">NodePosition</span></a><span class="Other">)</span> {.<span class="Identifier">inline</span><span class="Other">,</span> <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Moves the internal cursor position to <tt class="docutils literal"><span class="pre"><span class="Identifier">dest</span></span></tt>
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L131"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L131" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="skip,Changeset,Natural">
<dt><pre><span class="Keyword">func</span> <a href="#skip%2CChangeset%2CNatural"><span class="Identifier">skip</span></a><span class="Other">(</span><span class="Identifier">c</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a><span class="Other">;</span> <span class="Identifier">num</span><span class="Other">:</span> <span class="Identifier">Natural</span><span class="Other">)</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>


&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L193"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L193" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="updateSourceMap,SourceMap,PreparedChangeset">
<dt><pre><span class="Keyword">func</span> <a href="#updateSourceMap%2CSourceMap%2CPreparedChangeset"><span class="Identifier">updateSourceMap</span></a><span class="Other">(</span><span class="Identifier">m</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="sourcemaps.html#SourceMap"><span class="Identifier">SourceMap</span></a><span class="Other">;</span> <span class="Identifier">c</span><span class="Other">:</span> <a href="mirchangesets.html#PreparedChangeset"><span class="Identifier">PreparedChangeset</span></a><span class="Other">)</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Updates the source mappings stored by <tt class="docutils literal"><span class="pre"><span class="Identifier">m</span></span></tt> according to the changes recorded in <tt class="docutils literal"><span class="pre"><span class="Identifier">c</span></span></tt>
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L300"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L300" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</dl></div>
<div class="section" id="18">
<h1><a class="toc-backref" href="#18">Templates</a></h1>
<dl class="item">
<div id="insert.t,Changeset,NodeInstance,untyped,untyped">
<dt><pre><span class="Keyword">template</span> <a href="#insert.t%2CChangeset%2CNodeInstance%2Cuntyped%2Cuntyped"><span class="Identifier">insert</span></a><span class="Other">(</span><span class="Identifier">c</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a><span class="Other">;</span> <span class="Identifier">source</span><span class="Other">:</span> <a href="mirtrees.html#NodeInstance"><span class="Identifier">NodeInstance</span></a><span class="Other">;</span> <span class="Identifier">name</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span>
                <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
<dd>

Records an insertion at the current cursor position, providing direct access to the internal node buffer inside <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt> via an injected variable of the name <tt class="docutils literal"><span class="pre"><span class="Identifier">name</span></span></tt>. <tt class="docutils literal"><span class="pre"><span class="Identifier">source</span></span></tt> is the node to inherit the source/origin information from
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L149"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L149" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="position.t,Changeset">
<dt><pre><span class="Keyword">template</span> <a href="#position.t%2CChangeset"><span class="Identifier">position</span></a><span class="Other">(</span><span class="Identifier">cs</span><span class="Other">:</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a><span class="Other">)</span><span class="Other">:</span> <a href="mirtrees.html#NodePosition"><span class="Identifier">NodePosition</span></a></pre></dt>
<dd>

The current position of the cursor
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L127"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L127" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="replaceMulti.t,Changeset,untyped,untyped">
<dt><pre><span class="Keyword">template</span> <a href="#replaceMulti.t%2CChangeset%2Cuntyped%2Cuntyped"><span class="Identifier">replaceMulti</span></a><span class="Other">(</span><span class="Identifier">c</span><span class="Other">:</span> <span class="Keyword">var</span> <a href="mirchangesets.html#Changeset"><span class="Identifier">Changeset</span></a><span class="Other">;</span> <span class="Identifier">name</span><span class="Other">,</span> <span class="Identifier">body</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">)</span></pre></dt>
<dd>

Records a repacement of the node or sub-tree at the current cursor position, providing direct access to the internal node buffer inside <tt class="docutils literal"><span class="pre"><span class="Identifier">body</span></span></tt> via an injected variable of the name <tt class="docutils literal"><span class="pre"><span class="Identifier">name</span></span></tt>
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/f228a27d06bf68e8dc5a2db23c0680bea63ceb73/compiler/mir/mirchangesets.nim#L169"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/mir/mirchangesets.nim#L169" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2023-08-31 00:00:00 UTC</small>
      </div>
    </div>
  </div>
</div>
</body>
</html>

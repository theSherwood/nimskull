<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>compiler/sem/dfa</title>
<link rel="stylesheet" type="text/css" href="../nimdoc.out.css">

<script type="text/javascript" src="../dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  if (toggleSwitch !== null) {
    toggleSwitch.addEventListener('change', switchTheme, false);
  }

  var currentTheme = localStorage.getItem('theme');
  if (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    currentTheme = 'dark';
  }
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark' && toggleSwitch !== null) {
      toggleSwitch.checked = true;
    }
  }
}

window.addEventListener('DOMContentLoaded', main);
</script>

</head>
<body>
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">compiler/sem/dfa</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple-boot">
      <li><a href="manual.html">Manual</a></li>
      <li><a href="style_guide.html">Style guide</a></li>
      <li><a href="contributing.html">Contribution guide</a></li>
      <li><a href="lib.html">Standard library</a></li>
      <li><a href="../theindex.html">Index</a></li>
      <li><a href="compiler/../theindex.html">Compiler docs</a></li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
  
  <ul class="simple simple-toc" id="toc-list">
<li><a class="reference" id="join-is-no-more_toc" href="#join-is-no-more">Join is no more</a></li>
<li><a class="reference" id="design-of-join_toc" href="#design-of-join">Design of join</a></li>
<ul class="simple"><li><a class="reference" id="design-of-join-abstract-interpretation_toc" href="#design-of-join-abstract-interpretation">Abstract Interpretation</a></li>
</ul><li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#7" id="57">Types</a>
  <ul class="simple simple-toc-section">
      <li><a class="reference" href="#AliasKind"
    title="AliasKind = enum
  yes, no, maybe">AliasKind</a></li>
  <li><a class="reference" href="#ControlFlowGraph"
    title="ControlFlowGraph = seq[Instr]">ControlFlowGraph</a></li>
  <li><a class="reference" href="#Instr"
    title="Instr = object
  n*: PNode
  case kind*: InstrKind
  of goto, fork:
    dest*: int
  else:
    nil">Instr</a></li>
  <li><a class="reference" href="#InstrKind"
    title="InstrKind = enum
  goto, fork, def, use">InstrKind</a></li>

  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">aliases
      <li><a class="reference" href="#aliases%2CPNode%2CPNode"
    title="aliases(obj, field: PNode): AliasKind">aliases(obj, field: PNode): AliasKind</a></li>

  </ul>
  <ul class="simple nested-toc-section">constructCfg
      <li><a class="reference" href="#constructCfg%2CPSym%2CPNode"
    title="constructCfg(s: PSym; body: PNode): ControlFlowGraph">constructCfg(s: PSym; body: PNode): ControlFlowGraph</a></li>

  </ul>
  <ul class="simple nested-toc-section">echoCfg
      <li><a class="reference" href="#echoCfg%2CControlFlowGraph%2Cint%2Cint"
    title="echoCfg(c: ControlFlowGraph; start = 0; last = -1)">echoCfg(c: ControlFlowGraph; start = 0; last = -1)</a></li>

  </ul>
  <ul class="simple nested-toc-section">isAnalysableFieldAccess
      <li><a class="reference" href="#isAnalysableFieldAccess%2CPNode%2CPSym"
    title="isAnalysableFieldAccess(orig: PNode; owner: PSym): bool">isAnalysableFieldAccess(orig: PNode; owner: PSym): bool</a></li>

  </ul>
  <ul class="simple nested-toc-section">skipConvDfa
      <li><a class="reference" href="#skipConvDfa%2CPNode"
    title="skipConvDfa(n: PNode): PNode">skipConvDfa(n: PNode): PNode</a></li>

  </ul>

  </ul>
</li>

</ul>

  </div>
  &nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/3edb147a3e1490ff52c25a98c63a2d5dee6a56c6/compiler/sem/dfa.nim#L1"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/sem/dfa.nim#L1" class="link-seesrc" target="_blank" >Edit</a>

  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"><p>Data flow analysis for Nim. We transform the AST into a linear list of instructions first to make this easier to handle: There are only 2 different branching instructions: 'goto X' is an unconditional goto, 'fork X' is a conditional goto (either the next instruction or 'X' can be taken). Exhaustive case statements are translated so that the last branch is transformed into an 'else' branch. <tt class="docutils literal"><span class="pre">return</span></tt> and <tt class="docutils literal"><span class="pre">break</span></tt> are all covered by 'goto'.</p>
<p>Control flow through exception handling: Contrary to popular belief, exception handling doesn't cause many problems for this DFA representation, <tt class="docutils literal"><span class="pre">raise</span></tt> is a statement that <tt class="docutils literal"><span class="pre">goes to</span></tt> the outer <tt class="docutils literal"><span class="pre">finally</span></tt> or <tt class="docutils literal"><span class="pre">except</span></tt> if there is one, otherwise it is the same as <tt class="docutils literal"><span class="pre">return</span></tt>. Every call is treated as a call that can potentially <tt class="docutils literal"><span class="pre">raise</span></tt>. However, without a surrounding <tt class="docutils literal"><span class="pre">try</span></tt> we don't emit these <tt class="docutils literal"><span class="pre">fork ReturnLabel</span></tt> instructions in order to speed up the dataflow analysis passes.</p>
<p>The data structures and algorithms used here are inspired by &quot;A Graph–Free Approach to Data–Flow Analysis&quot; by Markus Mohnen. <a class="reference external" href="https://link.springer.com/content/pdf/10.1007/3-540-45937-5_6.pdf">https://link.springer.com/content/pdf/10.1007/3-540-45937-5_6.pdf</a></p>

<h1><a class="toc-backref" id="join-is-no-more" href="#join-is-no-more">Join is no more</a></h1><p>Instead of generating join instructions we adapt our traversal of the CFG.</p>
<p>When encountering a fork we split into two paths, we follow the path starting at &quot;pc + 1&quot; until it encounters the joinpoint: &quot;pc + forkInstr.dest&quot;. If we encounter gotos that would jump further than the current joinpoint, as can happen with gotos generated by unstructured controlflow such as break, raise or return, we simply suspend following the current path, and follow the other path until the new joinpoint which is simply the instruction pointer returned to us by the now suspended path. If the path we are following now, also encounters a goto that exceeds the joinpoint we repeat the process; suspending the current path and evaluating the other one with a new joinpoint. If we eventually reach a common joinpoint we join the two paths. This new &quot;ping-pong&quot; approach has the obvious advantage of not requiring join instructions, as such cutting down on the CFG size but is also mandatory for correctly handling complicated cases of unstructured controlflow.</p>

<h1><a class="toc-backref" id="design-of-join" href="#design-of-join">Design of join</a></h1><pre class="listing"><span class="Keyword">block</span><span class="Punctuation">:</span>
  <span class="Keyword">if</span> <span class="Identifier">cond</span><span class="Punctuation">:</span> <span class="Keyword">break</span>
  <span class="Identifier">def</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span>

<span class="Identifier">use</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span>

<span class="Identifier">Generates</span><span class="Punctuation">:</span>

<span class="Identifier">L0</span><span class="Punctuation">:</span> <span class="Identifier">fork</span> <span class="Identifier">lab1</span>
  <span class="Identifier">join</span> <span class="Identifier">L0</span>  <span class="Comment"># patched.</span>
  <span class="Identifier">goto</span> <span class="Identifier">Louter</span>
<span class="Identifier">lab1</span><span class="Punctuation">:</span>
  <span class="Identifier">def</span> <span class="Identifier">x</span>
  <span class="Identifier">join</span> <span class="Identifier">L0</span>
<span class="Identifier">Louter</span><span class="Punctuation">:</span>
  <span class="Identifier">use</span> <span class="Identifier">x</span>


<span class="Keyword">block</span> <span class="Identifier">outer</span><span class="Punctuation">:</span>
  <span class="Keyword">while</span> <span class="Identifier">a</span><span class="Punctuation">:</span>
    <span class="Keyword">while</span> <span class="Identifier">b</span><span class="Punctuation">:</span>
      <span class="Keyword">if</span> <span class="Identifier">foo</span><span class="Punctuation">:</span>
        <span class="Keyword">if</span> <span class="Identifier">bar</span><span class="Punctuation">:</span>
          <span class="Keyword">break</span> <span class="Identifier">outer</span> <span class="Comment"># --&gt; we need to 'join' every pushed 'fork' here</span></pre><p>This works and then our abstract interpretation needs to deal with 'fork' differently. It really causes a split in execution. Two threads are &quot;spawned&quot; and both need to reach the 'join L' instruction. Afterwards the abstract interpretations are joined and execution resumes single threaded.</p>

<h2><a class="toc-backref" id="design-of-join-abstract-interpretation" href="#design-of-join-abstract-interpretation">Abstract Interpretation</a></h2><pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">interpret</span><span class="Punctuation">(</span><span class="Identifier">pc</span><span class="Punctuation">,</span> <span class="Identifier">state</span><span class="Punctuation">,</span> <span class="Identifier">comesFrom</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">state</span> <span class="Operator">=</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">state</span>
  <span class="Comment"># we need an explicit 'create' instruction (an explicit heap), in order</span>
  <span class="Comment"># to deal with 'var x = create(); var y = x; var z = y; destroy(z)'</span>
  <span class="Keyword">while</span> <span class="Identifier">true</span><span class="Punctuation">:</span>
    <span class="Keyword">case</span> <span class="Identifier">pc</span>
    <span class="Keyword">of</span> <span class="Identifier">fork</span><span class="Punctuation">:</span>
      <span class="Keyword">let</span> <span class="Identifier">a</span> <span class="Operator">=</span> <span class="Identifier">interpret</span><span class="Punctuation">(</span><span class="Identifier">pc</span><span class="Operator">+</span><span class="DecNumber">1</span><span class="Punctuation">,</span> <span class="Identifier">result</span><span class="Punctuation">,</span> <span class="Identifier">pc</span><span class="Punctuation">)</span>
      <span class="Keyword">let</span> <span class="Identifier">b</span> <span class="Operator">=</span> <span class="Identifier">interpret</span><span class="Punctuation">(</span><span class="Identifier">forkTarget</span><span class="Punctuation">,</span> <span class="Identifier">result</span><span class="Punctuation">,</span> <span class="Identifier">pc</span><span class="Punctuation">)</span>
      <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">a</span> <span class="Operator">++</span> <span class="Identifier">b</span> <span class="Comment"># ++ is a union operation</span>
      <span class="Identifier">inc</span> <span class="Identifier">pc</span>
    <span class="Keyword">of</span> <span class="Identifier">join</span><span class="Punctuation">:</span>
      <span class="Keyword">if</span> <span class="Identifier">joinTarget</span> <span class="Operator">==</span> <span class="Identifier">comesFrom</span><span class="Punctuation">:</span> <span class="Keyword">return</span> <span class="Identifier">result</span>
      <span class="Keyword">else</span><span class="Punctuation">:</span> <span class="Identifier">inc</span> <span class="Identifier">pc</span>
    <span class="Keyword">of</span> <span class="Identifier">use</span> <span class="Identifier">X</span><span class="Punctuation">:</span>
      <span class="Keyword">if</span> <span class="Keyword">not</span> <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">contains</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
        <span class="Identifier">error</span> <span class="StringLit">&quot;variable not initialized &quot;</span> <span class="Operator">&amp;</span> <span class="Identifier">x</span>
      <span class="Identifier">inc</span> <span class="Identifier">pc</span>
    <span class="Keyword">of</span> <span class="Identifier">def</span> <span class="Identifier">X</span><span class="Punctuation">:</span>
      <span class="Keyword">if</span> <span class="Keyword">not</span> <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">contains</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
        <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">incl</span> <span class="Identifier">X</span>
      <span class="Keyword">else</span><span class="Punctuation">:</span>
        <span class="Identifier">error</span> <span class="StringLit">&quot;overwrite of variable causes memory leak &quot;</span> <span class="Operator">&amp;</span> <span class="Identifier">x</span>
      <span class="Identifier">inc</span> <span class="Identifier">pc</span>
    <span class="Keyword">of</span> <span class="Identifier">destroy</span> <span class="Identifier">X</span><span class="Punctuation">:</span>
      <span class="Identifier">result</span><span class="Operator">.</span><span class="Identifier">excl</span> <span class="Identifier">X</span></pre><p>This is correct but still can lead to false positives:</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">p</span><span class="Punctuation">(</span><span class="Identifier">cond</span><span class="Punctuation">:</span> <span class="Identifier">bool</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Keyword">if</span> <span class="Identifier">cond</span><span class="Punctuation">:</span>
    <span class="Identifier">new</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span>
  <span class="Identifier">otherThings</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Keyword">if</span> <span class="Identifier">cond</span><span class="Punctuation">:</span>
    <span class="Identifier">destroy</span> <span class="Identifier">x</span></pre><p>Is not a leak. We should find a way to model <em>data</em> flow, not just control flow. One solution is to rewrite the 'if' without a fork instruction. The unstructured aspect can now be easily dealt with the 'goto' and 'join' instructions.</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">p</span><span class="Punctuation">(</span><span class="Identifier">cond</span><span class="Punctuation">:</span> <span class="Identifier">bool</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Identifier">L0</span><span class="Punctuation">:</span> <span class="Identifier">fork</span> <span class="Identifier">Lend</span>
    <span class="Identifier">new</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">)</span>
    <span class="Comment"># do not 'join' here!</span>
  
  <span class="Identifier">Lend</span><span class="Punctuation">:</span>
    <span class="Identifier">otherThings</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    <span class="Identifier">join</span> <span class="Identifier">L0</span>  <span class="Comment"># SKIP THIS FOR new(x) SOMEHOW</span>
  <span class="Identifier">destroy</span> <span class="Identifier">x</span>
  <span class="Identifier">join</span> <span class="Identifier">L0</span> <span class="Comment"># but here.</span></pre><p>But if we follow 'goto Louter' we will never come to the join point. We restore the bindings after popping pc from the stack then there &quot;no&quot; problem?!</p>
<pre class="listing"><span class="Keyword">while</span> <span class="Identifier">cond</span><span class="Punctuation">:</span>
  <span class="Identifier">prelude</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Keyword">if</span> <span class="Keyword">not</span> <span class="Identifier">condB</span><span class="Punctuation">:</span> <span class="Keyword">break</span>
  <span class="Identifier">postlude</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Operator">---&gt;</span>
<span class="Keyword">var</span> <span class="Identifier">setFlag</span> <span class="Operator">=</span> <span class="Identifier">true</span>
<span class="Keyword">while</span> <span class="Identifier">cond</span> <span class="Keyword">and</span> <span class="Keyword">not</span> <span class="Identifier">setFlag</span><span class="Punctuation">:</span>
  <span class="Identifier">prelude</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Keyword">if</span> <span class="Keyword">not</span> <span class="Identifier">condB</span><span class="Punctuation">:</span>
    <span class="Identifier">setFlag</span> <span class="Operator">=</span> <span class="Identifier">true</span>   <span class="Comment"># BUT: Dependency</span>
  <span class="Keyword">if</span> <span class="Keyword">not</span> <span class="Identifier">setFlag</span><span class="Punctuation">:</span>    <span class="Comment"># HERE</span>
    <span class="Identifier">postlude</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Operator">---&gt;</span>
<span class="Keyword">var</span> <span class="Identifier">setFlag</span> <span class="Operator">=</span> <span class="Identifier">true</span>
<span class="Keyword">while</span> <span class="Identifier">cond</span> <span class="Keyword">and</span> <span class="Keyword">not</span> <span class="Identifier">setFlag</span><span class="Punctuation">:</span>
  <span class="Identifier">prelude</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Keyword">if</span> <span class="Keyword">not</span> <span class="Identifier">condB</span><span class="Punctuation">:</span>
    <span class="Identifier">postlude</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
    <span class="Identifier">setFlag</span> <span class="Operator">=</span> <span class="Identifier">true</span>


<span class="Operator">-------------------------------------------------</span>

<span class="Keyword">while</span> <span class="Identifier">cond</span><span class="Punctuation">:</span>
  <span class="Identifier">prelude</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Keyword">if</span> <span class="Identifier">more</span><span class="Punctuation">:</span>
    <span class="Keyword">if</span> <span class="Keyword">not</span> <span class="Identifier">condB</span><span class="Punctuation">:</span> <span class="Keyword">break</span>
    <span class="Identifier">stuffHere</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Identifier">postlude</span><span class="Punctuation">(</span><span class="Punctuation">)</span>

<span class="Operator">--&gt;</span>
<span class="Keyword">var</span> <span class="Identifier">setFlag</span> <span class="Operator">=</span> <span class="Identifier">true</span>
<span class="Keyword">while</span> <span class="Identifier">cond</span> <span class="Keyword">and</span> <span class="Keyword">not</span> <span class="Identifier">setFlag</span><span class="Punctuation">:</span>
  <span class="Identifier">prelude</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Keyword">if</span> <span class="Identifier">more</span><span class="Punctuation">:</span>
    <span class="Keyword">if</span> <span class="Keyword">not</span> <span class="Identifier">condB</span><span class="Punctuation">:</span>
      <span class="Identifier">setFlag</span> <span class="Operator">=</span> <span class="Identifier">false</span>
    <span class="Keyword">else</span><span class="Punctuation">:</span>
      <span class="Identifier">stuffHere</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
      <span class="Identifier">postlude</span><span class="Punctuation">(</span><span class="Punctuation">)</span>
  <span class="Keyword">else</span><span class="Punctuation">:</span>
    <span class="Identifier">postlude</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre><p>This is getting complicated. Instead we keep the whole 'join' idea but duplicate the 'join' instructions on breaks and return exits!</p>
</p>
  <div class="section" id="6">
<h1><a class="toc-backref" href="#6">Imports</a></h1>
<dl class="item">
<a class="reference external" href="../ast/ast.html">../ast/ast</a>, <a class="reference external" href="../ast/renderer.html">../ast/renderer</a>
</dl></div>
<div class="section" id="7">
<h1><a class="toc-backref" href="#7">Types</a></h1>
<dl class="item">
<div id="AliasKind">
<dt><pre><a href="dfa.html#AliasKind"><span class="Identifier">AliasKind</span></a> <span class="Other">=</span> <span class="Keyword">enum</span>
  <span class="Identifier">yes</span><span class="Other">,</span> <span class="Identifier">no</span><span class="Other">,</span> <span class="Identifier">maybe</span></pre></dt>
<dd>


&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/3edb147a3e1490ff52c25a98c63a2d5dee6a56c6/compiler/sem/dfa.nim#L604"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/sem/dfa.nim#L604" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="ControlFlowGraph">
<dt><pre><a href="dfa.html#ControlFlowGraph"><span class="Identifier">ControlFlowGraph</span></a> <span class="Other">=</span> <span class="Identifier">seq</span><span class="Other">[</span><a href="dfa.html#Instr"><span class="Identifier">Instr</span></a><span class="Other">]</span></pre></dt>
<dd>


&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/3edb147a3e1490ff52c25a98c63a2d5dee6a56c6/compiler/sem/dfa.nim#L52"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/sem/dfa.nim#L52" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="Instr">
<dt><pre><a href="dfa.html#Instr"><span class="Identifier">Instr</span></a> <span class="Other">=</span> <span class="Keyword">object</span>
  <span class="Identifier">n</span><span class="Operator">*</span><span class="Other">:</span> <a href="../ast/ast_types.html#PNode"><span class="Identifier">PNode</span></a>
  <span class="Keyword">case</span> <span class="Identifier">kind</span><span class="Operator">*</span><span class="Other">:</span> <a href="dfa.html#InstrKind"><span class="Identifier">InstrKind</span></a>
  <span class="Keyword">of</span> <span class="Identifier">goto</span><span class="Other">,</span> <span class="Identifier">fork</span><span class="Other">:</span>
    <span class="Identifier">dest</span><span class="Operator">*</span><span class="Other">:</span> <span class="Identifier">int</span>
  <span class="Keyword">else</span><span class="Other">:</span>
    <span class="Keyword">nil</span>
  </pre></dt>
<dd>


&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/3edb147a3e1490ff52c25a98c63a2d5dee6a56c6/compiler/sem/dfa.nim#L46"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/sem/dfa.nim#L46" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="InstrKind">
<dt><pre><a href="dfa.html#InstrKind"><span class="Identifier">InstrKind</span></a> <span class="Other">=</span> <span class="Keyword">enum</span>
  <span class="Identifier">goto</span><span class="Other">,</span> <span class="Identifier">fork</span><span class="Other">,</span> <span class="Identifier">def</span><span class="Other">,</span> <span class="Identifier">use</span></pre></dt>
<dd>


&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/3edb147a3e1490ff52c25a98c63a2d5dee6a56c6/compiler/sem/dfa.nim#L44"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/sem/dfa.nim#L44" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">
<div id="aliases,PNode,PNode">
<dt><pre><span class="Keyword">proc</span> <a href="#aliases%2CPNode%2CPNode"><span class="Identifier">aliases</span></a><span class="Other">(</span><span class="Identifier">obj</span><span class="Other">,</span> <span class="Identifier">field</span><span class="Other">:</span> <a href="../ast/ast_types.html#PNode"><span class="Identifier">PNode</span></a><span class="Other">)</span><span class="Other">:</span> <a href="dfa.html#AliasKind"><span class="Identifier">AliasKind</span></a> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

<table border="1" class="docutils"><tr><th>obj</th><th>field</th><th>alias kind</th></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span></span></tt></td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span></span></tt></td><td>true</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span></span></tt></td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Operator">.</span><span class="Identifier">f</span></span></tt></td><td>true</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Operator">.</span><span class="Identifier">f</span></span></tt></td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span></span></tt></td><td>false</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Operator">.</span><span class="Identifier">f</span></span></tt></td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Operator">.</span><span class="Identifier">f</span></span></tt></td><td>true</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Operator">.</span><span class="Identifier">f</span></span></tt></td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Operator">.</span><span class="Identifier">v</span></span></tt></td><td>false</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span></span></tt></td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span></span></tt></td><td>true</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="DecNumber">0</span></span></tt>]</td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span></span></tt></td><td>false</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="DecNumber">0</span></span></tt>]</td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span></span></tt></td><td>true</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="DecNumber">0</span></span></tt>]</td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">]</span></span></tt></td><td>false</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span></span></tt></td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="Identifier">i</span><span class="Punctuation">]</span></span></tt></td><td>true</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="Identifier">i</span></span></tt>]</td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span></span></tt></td><td>false</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="Identifier">i</span></span></tt>]</td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="Identifier">i</span><span class="Punctuation">]</span></span></tt></td><td>maybe; Further analysis could make this return true when i is a runtime-constant</td></tr>
<tr><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="Identifier">i</span></span></tt>]</td><td><tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Punctuation">[</span><span class="Identifier">j</span><span class="Punctuation">]</span></span></tt></td><td>maybe; also returns maybe if only one of i or j is a compiletime-constant</td></tr>
<tr><td></td><td></td><td></td></tr>
</table>
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/3edb147a3e1490ff52c25a98c63a2d5dee6a56c6/compiler/sem/dfa.nim#L607"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/sem/dfa.nim#L607" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="constructCfg,PSym,PNode">
<dt><pre><span class="Keyword">proc</span> <a href="#constructCfg%2CPSym%2CPNode"><span class="Identifier">constructCfg</span></a><span class="Other">(</span><span class="Identifier">s</span><span class="Other">:</span> <a href="../ast/ast_types.html#PSym"><span class="Identifier">PSym</span></a><span class="Other">;</span> <span class="Identifier">body</span><span class="Other">:</span> <a href="../ast/ast_types.html#PNode"><span class="Identifier">PNode</span></a><span class="Other">)</span><span class="Other">:</span> <a href="dfa.html#ControlFlowGraph"><span class="Identifier">ControlFlowGraph</span></a> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">Exception</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

constructs a control flow graph for <tt class="docutils literal"><span class="pre">body</span></tt>.
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/3edb147a3e1490ff52c25a98c63a2d5dee6a56c6/compiler/sem/dfa.nim#L837"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/sem/dfa.nim#L837" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="echoCfg,ControlFlowGraph,int,int">
<dt><pre><span class="Keyword">proc</span> <a href="#echoCfg%2CControlFlowGraph%2Cint%2Cint"><span class="Identifier">echoCfg</span></a><span class="Other">(</span><span class="Identifier">c</span><span class="Other">:</span> <a href="dfa.html#ControlFlowGraph"><span class="Identifier">ControlFlowGraph</span></a><span class="Other">;</span> <span class="Identifier">start</span> <span class="Other">=</span> <span class="DecNumber">0</span><span class="Other">;</span> <span class="Identifier">last</span> <span class="Other">=</span> <span class="DecNumber">-1</span><span class="Other">)</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">deprecated</span><span class="Other">,</span>
    <span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">Exception</span><span class="Other">,</span> <span class="Identifier">KeyError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span></span>.}</pre></dt>
<dd>
  <div class="deprecation-message">
    <b>Deprecated</b> 
  </div>

echos the ControlFlowGraph for debugging purposes.
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/3edb147a3e1490ff52c25a98c63a2d5dee6a56c6/compiler/sem/dfa.nim#L97"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/sem/dfa.nim#L97" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="isAnalysableFieldAccess,PNode,PSym">
<dt><pre><span class="Keyword">proc</span> <a href="#isAnalysableFieldAccess%2CPNode%2CPSym"><span class="Identifier">isAnalysableFieldAccess</span></a><span class="Other">(</span><span class="Identifier">orig</span><span class="Other">:</span> <a href="../ast/ast_types.html#PNode"><span class="Identifier">PNode</span></a><span class="Other">;</span> <span class="Identifier">owner</span><span class="Other">:</span> <a href="../ast/ast_types.html#PSym"><span class="Identifier">PSym</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>


&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/3edb147a3e1490ff52c25a98c63a2d5dee6a56c6/compiler/sem/dfa.nim#L681"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/sem/dfa.nim#L681" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="skipConvDfa,PNode">
<dt><pre><span class="Keyword">proc</span> <a href="#skipConvDfa%2CPNode"><span class="Identifier">skipConvDfa</span></a><span class="Other">(</span><span class="Identifier">n</span><span class="Other">:</span> <a href="../ast/ast_types.html#PNode"><span class="Identifier">PNode</span></a><span class="Other">)</span><span class="Other">:</span> <a href="../ast/ast_types.html#PNode"><span class="Identifier">PNode</span></a> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>


&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/3edb147a3e1490ff52c25a98c63a2d5dee6a56c6/compiler/sem/dfa.nim#L594"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/sem/dfa.nim#L594" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2023-06-03 00:00:00 UTC</small>
      </div>
    </div>
  </div>
</div>
</body>
</html>

<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>compiler/backend/cgirgen</title>
<link rel="stylesheet" type="text/css" href="../nimdoc.out.css">

<script type="text/javascript" src="../dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  if (toggleSwitch !== null) {
    toggleSwitch.addEventListener('change', switchTheme, false);
  }

  var currentTheme = localStorage.getItem('theme');
  if (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    currentTheme = 'dark';
  }
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark' && toggleSwitch !== null) {
      toggleSwitch.checked = true;
    }
  }
}

window.addEventListener('DOMContentLoaded', main);
</script>

</head>
<body>
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">compiler/backend/cgirgen</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple-boot">
      <li><a href="manual.html">Manual</a></li>
      <li><a href="style_guide.html">Style guide</a></li>
      <li><a href="contributing.html">Contribution guide</a></li>
      <li><a href="lib.html">Standard library</a></li>
      <li><a href="../theindex.html">Index</a></li>
      <li><a href="compiler/../theindex.html">Compiler docs</a></li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
  
  <ul class="simple simple-toc" id="toc-list">
<li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
  <ul class="simple simple-toc-section">
    
  </ul>
</li>
<li>
  <a class="reference reference-toplevel" href="#12" id="62">Procs</a>
  <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">canUseView
      <li><a class="reference" href="#canUseView%2CCgNode"
    title="canUseView(n: CgNode): bool">canUseView(n: CgNode): bool</a></li>

  </ul>
  <ul class="simple nested-toc-section">flattenExpr
      <li><a class="reference" href="#flattenExpr%2CCgNode%2Cseq%5BCgNode%5D"
    title="flattenExpr(expr: CgNode; stmts: var seq[CgNode]): CgNode">flattenExpr(expr: CgNode; stmts: var seq[CgNode]): CgNode</a></li>

  </ul>
  <ul class="simple nested-toc-section">generateIR
      <li><a class="reference" href="#generateIR%2CModuleGraph%2CIdGenerator%2CPSym%2CsinkMirTree%2CsinkSourceMap"
    title="generateIR(graph: ModuleGraph; idgen: IdGenerator; owner: PSym;
           tree: sink MirTree; sourceMap: sink SourceMap): Body">generateIR(graph: ModuleGraph; idgen: IdGenerator; owner: PSym;
           tree: sink MirTree; sourceMap: sink SourceMap): Body</a></li>

  </ul>
  <ul class="simple nested-toc-section">translateLit
      <li><a class="reference" href="#translateLit%2CPNode"
    title="translateLit(val: PNode): CgNode">translateLit(val: PNode): CgNode</a></li>

  </ul>

  </ul>
</li>

</ul>

  </div>
  &nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/e62b836c8d062e8236a729f7fae09972ffb3c2a3/compiler/backend/cgirgen.nim#L1"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/backend/cgirgen.nim#L1" class="link-seesrc" target="_blank" >Edit</a>

  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"><p>Implements generating <tt class="docutils literal"><span class="pre">CgNode</span></tt> code from MIR code. Together with the <tt class="docutils literal"><span class="pre">CgNode</span></tt> IR, this module is a work-in-progress.</p>
<p>The translation is implemented via recursive application of the correct translation procedure, where each procedure processes a sub-tree either directly or via further recursion. Instead of one uber procedure, multiple smaller ones that closely match the grammer are used. This allows for validating that the input MIR code is grammatically correct with effectively no overhead and without requiring extra contextual data or a separate pass.</p>
<div class="admonition admonition-info"><span class="admonition-info-text"><b>Note:</b></span>
The <tt class="docutils literal"><span class="pre"><span class="Identifier">tb</span></span></tt> prefix is an abbreviation of &quot;translate back&quot;, but with the introduction of the code-generator IR, this doesn't make much sense anymore.</div>
<h1 id="mir-regions"><center>MIR regions</center></h1><p>There exists no equivalent to MIR regions in the <tt class="docutils literal"><span class="pre">CgNode</span></tt> IR, so a more complex translation has to be used. At the start of the region, each region argument is assigned to a temporary, using either a <tt class="docutils literal"><span class="pre">var</span></tt> / <tt class="docutils literal"><span class="pre">lent</span></tt> view or shallow copy depending on the argument's mode and type. A region parameter reference (<tt class="docutils literal"><span class="pre">mnkOpParam</span></tt>) is then translated to accessing the temporary introduce for the parameter's argument.</p>
</p>
  <div class="section" id="6">
<h1><a class="toc-backref" href="#6">Imports</a></h1>
<dl class="item">
<a class="reference external" href="../ast/ast_types.html">../ast/ast_types</a>, <a class="reference external" href="../ast/ast_idgen.html">../ast/ast_idgen</a>, <a class="reference external" href="../ast/ast_query.html">../ast/ast_query</a>, <a class="reference external" href="../ast/lineinfos.html">../ast/lineinfos</a>, <a class="reference external" href="../ast/types.html">../ast/types</a>, <a class="reference external" href="cgir.html">cgir</a>, <a class="reference external" href="../front/options.html">../front/options</a>, <a class="reference external" href="../mir/mirtrees.html">../mir/mirtrees</a>, <a class="reference external" href="../mir/sourcemaps.html">../mir/sourcemaps</a>, <a class="reference external" href="../modules/magicsys.html">../modules/magicsys</a>, <a class="reference external" href="../modules/modulegraphs.html">../modules/modulegraphs</a>, <a class="reference external" href="../utils/containers.html">../utils/containers</a>, <a class="reference external" href="../utils/idioms.html">../utils/idioms</a>, <a class="reference external" href="../utils/int128.html">../utils/int128</a>, <a class="reference external" href="../ast/ast.html">../ast/ast</a>, <a class="reference external" href="../ast/idents.html">../ast/idents</a>, <a class="reference external" href="../sem/semdata.html">../sem/semdata</a>, <a class="reference external" href="../vm/vmaux.html">../vm/vmaux</a>
</dl></div>
<div class="section" id="12">
<h1><a class="toc-backref" href="#12">Procs</a></h1>
<dl class="item">
<div id="canUseView,CgNode">
<dt><pre><span class="Keyword">proc</span> <a href="#canUseView%2CCgNode"><span class="Identifier">canUseView</span></a><span class="Other">(</span><span class="Identifier">n</span><span class="Other">:</span> <a href="cgir.html#CgNode"><span class="Identifier">CgNode</span></a><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">bool</span> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">KeyError</span><span class="Other">,</span> <span class="Identifier">Exception</span><span class="Other">,</span>
    <span class="Identifier">ERecoverableError</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

A copy of <a class="reference external" href="ast/ast_analysis.html#PNode,seq[PNode]">canUseView</a> adjusted for <tt class="docutils literal"><span class="pre">CgNode</span></tt>.
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/e62b836c8d062e8236a729f7fae09972ffb3c2a3/compiler/backend/cgirgen.nim#L619"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/backend/cgirgen.nim#L619" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="flattenExpr,CgNode,seq[CgNode]">
<dt><pre><span class="Keyword">proc</span> <a href="#flattenExpr%2CCgNode%2Cseq%5BCgNode%5D"><span class="Identifier">flattenExpr</span></a><span class="Other">(</span><span class="Identifier">expr</span><span class="Other">:</span> <a href="cgir.html#CgNode"><span class="Identifier">CgNode</span></a><span class="Other">;</span> <span class="Identifier">stmts</span><span class="Other">:</span> <span class="Keyword">var</span> <span class="Identifier">seq</span><span class="Other">[</span><a href="cgir.html#CgNode"><span class="Identifier">CgNode</span></a><span class="Other">]</span><span class="Other">)</span><span class="Other">:</span> <a href="cgir.html#CgNode"><span class="Identifier">CgNode</span></a> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

A copy of <a class="reference external" href="ast/trees.html#PNode,seq[PNode]">flattenExpr</a> adjusted for <tt class="docutils literal"><span class="pre">CgNode</span></tt>.
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/e62b836c8d062e8236a729f7fae09972ffb3c2a3/compiler/backend/cgirgen.nim#L580"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/backend/cgirgen.nim#L580" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="generateIR,ModuleGraph,IdGenerator,PSym,sinkMirTree,sinkSourceMap">
<dt><pre><span class="Keyword">proc</span> <a href="#generateIR%2CModuleGraph%2CIdGenerator%2CPSym%2CsinkMirTree%2CsinkSourceMap"><span class="Identifier">generateIR</span></a><span class="Other">(</span><span class="Identifier">graph</span><span class="Other">:</span> <a href="../modules/modulegraphs.html#ModuleGraph"><span class="Identifier">ModuleGraph</span></a><span class="Other">;</span> <span class="Identifier">idgen</span><span class="Other">:</span> <a href="../ast/ast_idgen.html#IdGenerator"><span class="Identifier">IdGenerator</span></a><span class="Other">;</span> <span class="Identifier">owner</span><span class="Other">:</span> <a href="../ast/ast_types.html#PSym"><span class="Identifier">PSym</span></a><span class="Other">;</span>
                <span class="Identifier">tree</span><span class="Other">:</span> <span class="Identifier">sink</span> <a href="../mir/mirtrees.html#MirTree"><span class="Identifier">MirTree</span></a><span class="Other">;</span> <span class="Identifier">sourceMap</span><span class="Other">:</span> <span class="Identifier">sink</span> <a href="../mir/sourcemaps.html#SourceMap"><span class="Identifier">SourceMap</span></a><span class="Other">)</span><span class="Other">:</span> <a href="cgir.html#Body"><span class="Identifier">Body</span></a> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">KeyError</span><span class="Other">,</span> <span class="Identifier">Exception</span><span class="Other">,</span> <span class="Identifier">ERecoverableError</span><span class="Other">]</span><span class="Other">,</span>
    <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Identifier">RootEffect</span><span class="Other">,</span> <span class="Identifier">ReadDirEffect</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Generates the <tt class="docutils literal"><span class="pre">CgNode</span></tt> IR corresponding to the input MIR code (<tt class="docutils literal"><span class="pre"><span class="Identifier">tree</span></span></tt>), using <tt class="docutils literal"><span class="pre"><span class="Identifier">idgen</span></span></tt> for provide new IDs when creating symbols. <tt class="docutils literal"><span class="pre"><span class="Identifier">sourceMap</span></span></tt> must be the <tt class="docutils literal"><span class="pre">SourceMap</span></tt> corresponding to <tt class="docutils literal"><span class="pre"><span class="Identifier">tree</span></span></tt> and is used as the provider for source position information
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/e62b836c8d062e8236a729f7fae09972ffb3c2a3/compiler/backend/cgirgen.nim#L1407"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/backend/cgirgen.nim#L1407" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>
<div id="translateLit,PNode">
<dt><pre><span class="Keyword">proc</span> <a href="#translateLit%2CPNode"><span class="Identifier">translateLit</span></a><span class="Other">(</span><span class="Identifier">val</span><span class="Other">:</span> <a href="../ast/ast_types.html#PNode"><span class="Identifier">PNode</span></a><span class="Other">)</span><span class="Other">:</span> <a href="cgir.html#CgNode"><span class="Identifier">CgNode</span></a> {.<span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
<dd>

Translates an <tt class="docutils literal"><span class="pre">mnkLiteral</span></tt> node to a <tt class="docutils literal"><span class="pre">CgNode</span></tt>. Note that the MIR not only uses <tt class="docutils literal"><span class="pre">mnkLiteral</span></tt> for &quot;real&quot; literals, but also for pushing other raw <tt class="docutils literal"><span class="pre">PNode</span></tt>s through the MIR phase.
&nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/e62b836c8d062e8236a729f7fae09972ffb3c2a3/compiler/backend/cgirgen.nim#L265"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/compiler/backend/cgirgen.nim#L265" class="link-seesrc" target="_blank" >Edit</a>

</dd>
</div>

</dl></div>

  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2023-10-11 00:00:00 UTC</small>
      </div>
    </div>
  </div>
</div>
</body>
</html>

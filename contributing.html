<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>Contributing</title>
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<script type="text/javascript" src="dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  if (toggleSwitch !== null) {
    toggleSwitch.addEventListener('change', switchTheme, false);
  }

  var currentTheme = localStorage.getItem('theme');
  if (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    currentTheme = 'dark';
  }
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark' && toggleSwitch !== null) {
      toggleSwitch.checked = true;
    }
  }
}

window.addEventListener('DOMContentLoaded', main);
</script>

</head>
<body>
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">Contributing</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple-boot">
      <li><a href="manual.html">Manual</a></li>
      <li><a href="style_guide.html">Style guide</a></li>
      <li><a href="contributing.html">Contribution guide</a></li>
      <li><a href="lib.html">Standard library</a></li>
      <li><a href="theindex.html">Index</a></li>
      <li><a href="compiler/theindex.html">Compiler docs</a></li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
    <div class="search-groupby">
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>

  <ul class="simple simple-toc" id="toc-list">
<li><a class="reference" id="getting-started_toc" href="#getting-started">Getting Started</a></li>
<li><a class="reference" id="change-approval_toc" href="#change-approval">Change Approval</a></li>
<li><a class="reference" id="anatomy-of-a-pull-request_toc" href="#anatomy-of-a-pull-request">Anatomy of a Pull Request</a></li>
<ul class="simple"><li><a class="reference" id="anatomy-of-a-pull-request-commit-message_toc" href="#anatomy-of-a-pull-request-commit-message">Commit Message</a></li>
<ul class="simple"><li><a class="reference" id="commit-message-how-to-write-a-good-commit-message_toc" href="#commit-message-how-to-write-a-good-commit-message">How to Write a Good Commit Message</a></li>
<li><a class="reference" id="commit-message-is-my-commit-message-is-acceptableqmark_toc" href="#commit-message-is-my-commit-message-is-acceptableqmark">Is my Commit Message is Acceptable?</a></li>
<li><a class="reference" id="commit-message-getting-fancy-with-commit-messages_toc" href="#commit-message-getting-fancy-with-commit-messages">Getting Fancy with Commit Messages</a></li>
<li><a class="reference" id="commit-message-what-to-avoid_toc" href="#commit-message-what-to-avoid">What to Avoid</a></li>
<li><a class="reference" id="commit-message-additional-considerations_toc" href="#commit-message-additional-considerations">Additional considerations</a></li>
</ul><li><a class="reference" id="anatomy-of-a-pull-request-continuous-integration-ci_toc" href="#anatomy-of-a-pull-request-continuous-integration-ci">Continuous Integration (CI)</a></li>
<ul class="simple"><li><a class="reference" id="continuous-integration-ci-debugging-ci-failures-flaky-tests-etc_toc" href="#continuous-integration-ci-debugging-ci-failures-flaky-tests-etc">Debugging CI failures, flaky tests, etc</a></li>
</ul></ul><li><a class="reference" id="change-specific-guidance_toc" href="#change-specific-guidance">Change Specific Guidance</a></li>
<ul class="simple"><li><a class="reference" id="change-specific-guidance-breaking-changes_toc" href="#change-specific-guidance-breaking-changes">&quot;Breaking&quot; Changes</a></li>
<li><a class="reference" id="change-specific-guidance-compilerslashlanguage-spec-bugfixes_toc" href="#change-specific-guidance-compilerslashlanguage-spec-bugfixes">Compiler/language spec bugfixes</a></li>
<li><a class="reference" id="change-specific-guidance-evolving-the-stdlib_toc" href="#change-specific-guidance-evolving-the-stdlib">Evolving the stdlib</a></li>
</ul><li><a class="reference" id="testing_toc" href="#testing">Testing</a></li>
<ul class="simple"><li><a class="reference" id="testing-writing-tests_toc" href="#testing-writing-tests">Writing Tests</a></li>
<li><a class="reference" id="testing-running-tests_toc" href="#testing-running-tests">Running Tests</a></li>
<li><a class="reference" id="testing-comparing-tests_toc" href="#testing-comparing-tests">Comparing tests</a></li>
<li><a class="reference" id="testing-useful-test-patterns_toc" href="#testing-useful-test-patterns">Useful Test Patterns</a></li>
</ul><li><a class="reference" id="documenting_toc" href="#documenting">Documenting</a></li>
<ul class="simple"><li><a class="reference" id="documenting-general-guidelines_toc" href="#documenting-general-guidelines">General Guidelines</a></li>
<li><a class="reference" id="documenting-documentation-style-guidelines_toc" href="#documenting-documentation-style-guidelines">Documentation Style Guidelines</a></li>
<ul class="simple"><li><a class="reference" id="documentation-style-guidelines-moduleminuslevel-documentation_toc" href="#documentation-style-guidelines-moduleminuslevel-documentation">Module-level documentation</a></li>
<li><a class="reference" id="documentation-style-guidelines-procs-templates-macros-converters-and-iterators_toc" href="#documentation-style-guidelines-procs-templates-macros-converters-and-iterators">Procs, Templates, Macros, Converters, and Iterators</a></li>
<li><a class="reference" id="documentation-style-guidelines-types_toc" href="#documentation-style-guidelines-types">Types</a></li>
<li><a class="reference" id="documentation-style-guidelines-var-let-and-const_toc" href="#documentation-style-guidelines-var-let-and-const">Var, Let, and Const</a></li>
</ul></ul><li><a class="reference" id="starter-contribution-areas_toc" href="#starter-contribution-areas">Starter Contribution Areas</a></li>
<ul class="simple"><li><a class="reference" id="starter-contribution-areas-writing-or-improving-tests_toc" href="#starter-contribution-areas-writing-or-improving-tests">Writing or improving tests</a></li>
<li><a class="reference" id="starter-contribution-areas-improving-language-specification_toc" href="#starter-contribution-areas-improving-language-specification">Improving Language specification</a></li>
<li><a class="reference" id="starter-contribution-areas-cleaning-up-existing-tests_toc" href="#starter-contribution-areas-cleaning-up-existing-tests">Cleaning up Existing Tests</a></li>
</ul>
</ul>

  </div>
  &nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/9087a6221f9aa5e0e6d2d7f56138090e208dea57/doc/contributing.rst#L1"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/doc/contributing.rst#L1" class="link-seesrc" target="_blank" >Edit</a>

  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"><p>Especially if you're looking to contribute a large change, please read this short blurb on <a class="reference external" href="https://github.com/nim-works/nimskull#direction">the direction</a> of the language.</p>
<p>Specifically, we value  sustainability. This means that the way we work together, our customs and practices, the design and development of the language, associated libraries, tools and so on, all work towards this goal.</p>
<p>At present the primary mechanism of contributions are by way of Pull Requests, which at a minimum:</p>
<ul class="simple"><li>consists of the, ideally small, change</li>
<li>are tested and the Continuous Integration checks pass</li>
<li>have a clear and neat commit and PR message</li>
<li>approved by at least one core developer</li>
</ul>

<h1><a class="toc-backref" id="getting-started" href="#getting-started">Getting Started</a></h1><p>For a very small change (typos, fixes, etc) please, open up a PR with tests and a fix, with help from the rest of this guide this will be quick and easy.</p>
<p>If you're looking for ideas to work on, or to make more impactful or sweeping changes, then we recommend gaining some context through one or more of these suggested activities:</p>
<ul class="simple"><li>check the <a class="reference external" href="https://github.com/nim-works/nimskull#near-term-development">current near-term development plan</a></li>
<li>see current efforts by reading the last <a class="reference external" href="https://github.com/nim-works/nimskull/commits/devel">~10 commits messages</a></li>
<li>to understand the current broader ideas, <a class="reference external" href="https://github.com/nim-works/nimskull/discussions">see recent discussions</a></li>
<li>check out roadmap progression <a class="reference external" href="https://github.com/nim-works/nimskull/discussions/142?sort=new">thread</a> for a high-level overview</li>
<li>join our <a class="reference external" href="https://matrix.to/#/#nimworks:envs.net">matrix chat</a></li>
</ul>
<p>This context gathering helps, as not everything is being worked on and somethings may in fact be up for removal outright. It's a big code base, and sometimes it's not easy to see where things are headed. What trade-offs to make and all sorts of questions that arise during software development.</p>

<h1><a class="toc-backref" id="change-approval" href="#change-approval">Change Approval</a></h1><p>We recognize that contributors are the life blood of this project. Our intention is to both encourage new contributors and ensure one contributor's actions don't takeaway the momentum of others and the project as a whole. This is how contribution reviews are approached:</p>
<ol class="simple"><li>monotonic improvements, a change must leave things better than before</li>
<li>at least one core developer must approve</li>
</ol>
<p>Small changes, docs, typos, bug fixes, items reported in issues, test, standard lib improvements, etc can easily be accommodated with the PR review cycle. Note for &quot;bigger&quot; small changes discussing it in chat/issues prior to submitting a PR can smooth the process.</p>
<p>Changes, especially larger ones, often result in debates or back and forth in review. No code is perfect and the intention of review is to ensure progress, for contributors the review will be proportionate to the following:</p>
<ol class="simple"><li>impact of the change</li>
<li>cost of changing the code in the future</li>
<li>contributor's history instilling trust they'll keep contributing</li>
</ol>
<p>Finally, discussion cannot resolve things and to maintain a cohesive direction, resolving debates or matters of direction/taste, the final word is with Saem.</p>
<div class="admonition admonition-info"><span class="admonition-info-text"><b>Tip:</b></span>
Small PRs, simple implementation (state/control flow), principled design, thoughtful testing, documented code, and the like cut through lengthy back and forth.</div>

<h1><a class="toc-backref" id="anatomy-of-a-pull-request" href="#anatomy-of-a-pull-request">Anatomy of a Pull Request</a></h1><p>There is a GitHub Pull Request template to help guide crafting a description, and you can liberally copy content from the commit messages as needed.</p>
<p>If your PR isn't quite ready feel free to create it as a draft, then once you're all set feel free to flip it to &quot;Ready for review&quot;.</p>
<p>The PR can have as many commits as you want, with multiple commits being preferred, as it can make review easier, especially when there are many changes.</p>
<p>When the PR is merged, a squashed version of the commits is automatically created (leaving both the original branch and the commits as they show up in the history on GitHub intact), with everything coming before the first section break (<tt class="docutils literal"><span class="pre"><span class="Operator">---</span></span></tt>) in the PR message being used as the commit message.</p>
<p>Force pushing to a branch for which a PR has already been created is okay, but please try to only rewrite history for commits that haven't been reviewed yet, so as to make incremental reviews easier.</p>

<h2><a class="toc-backref" id="anatomy-of-a-pull-request-commit-message" href="#anatomy-of-a-pull-request-commit-message">Commit Message</a></h2><p>One of the key goals of the  nimskull project is sustainability. Writing good commit messages is important, since future contributors need to have a way to reason about decisions made in the past.</p>
<p>The impact (<em>&quot;what&quot;</em>) and reasoning (<em>&quot;why&quot;</em>) of the change <strong>must</strong> be clear, and for more complex changes an overview of the approach (<em>&quot;how&quot;</em>).</p>
<pre class="listing">transf: move the `ImplicitObjConv` hint to `sempass2`

The hint is about program semantics and should thus be reported
during semantic analysis. This is a step towards removing all
program-semantics-related diagnostics reporting from both the
transformation and back-end phase.

As a side-effect of this change, the hint is now produced for all code
part of the compilation, instead of only for alive code.</pre><p><em>transf: move the `ImplicitObjConv` hint to `sempass2`</em>: descibes the change, the <em>transf:</em> prefix describes where the change occurred and is recommended to help disambiguate changes.</p>
<p>The body, starting with <em>The hint is about ...</em> paragraph describes the impact of the change, as well as the reasoning behind it. Finally, the second paragraph highlights indirect/additional impact of the change.</p>
<p>Last but not least, the text formatting of the the commit message must be:<pre>Maximum 50 character title

Body is separated from the title by a new line. Each line in the body
is wrapped to a maximum of 72 characters.</pre>
</p>
<p>The title is formatted to 50 characters or less and describes what changed, it also is prefixed by the recommended location/subsystem of the change.</p>

<h3><a class="toc-backref" id="commit-message-how-to-write-a-good-commit-message" href="#commit-message-how-to-write-a-good-commit-message">How to Write a Good Commit Message</a></h3><p>When writing commit message consider who are you writing this message for:</p>
<ul class="simple"><li>you or someone else in the far future found a bug and stumbled upon this in a git bisect</li>
<li>you or someone else is going through commits trying to write a changelog</li>
<li>you or someone else is trying to find a bug that can't be replicated reliably so they're reading commits seeing which might be related</li>
<li>someone new to the codebase is trying to learn bits and pieces about what's being worked on and what types of things are changing</li>
<li>you or someone else is sorting out documentation, find gaps in testing, or seeing if old issues can be closed with recent changes</li>
</ul>

<h3><a class="toc-backref" id="commit-message-is-my-commit-message-is-acceptableqmark" href="#commit-message-is-my-commit-message-is-acceptableqmark">Is my Commit Message is Acceptable?</a></h3><p>Commit message should contain enough information in order for the end user to understand what is going on by looking at the git log.</p>
<p>If your commit message requires the reader to play detective to piece together the impact, reasoning, and other pertinent information, it'll be rejected.</p>
<p>A classic case of a git commit message that'll be rejected:<pre>Fixes #123; refs #124</pre>
</p>

<h3><a class="toc-backref" id="commit-message-getting-fancy-with-commit-messages" href="#commit-message-getting-fancy-with-commit-messages">Getting Fancy with Commit Messages</a></h3><p>The recommended &quot;where&quot; prefix for commit titles, can be a specific file, or a subsystem (like <tt class="docutils literal"><span class="pre"><span class="Identifier">sem</span></span></tt> (semantic analysis in compiler), <tt class="docutils literal"><span class="pre"><span class="Identifier">lexer</span></span></tt> (compiler lexer), <tt class="docutils literal"><span class="pre"><span class="Identifier">stdlib</span></span></tt> (standard library), <tt class="docutils literal"><span class="pre"><span class="Identifier">tests</span></span></tt>, <tt class="docutils literal"><span class="pre"><span class="Identifier">spec</span></span></tt> (for language specification improvements) and so on).</p>
<p>When using the &quot;fixes&quot; feature in GitHub to automatically close issues, use the full URL instead of a GitHub <tt class="docutils literal"><span class="pre"><span class="Comment">#</span></span></tt> prefixed id.</p>

<h3><a class="toc-backref" id="commit-message-what-to-avoid" href="#commit-message-what-to-avoid">What to Avoid</a></h3><p>If your commit message requires a reader to play detective to piece together the impact, reasoning, and other pertinent information, it'll be rejected.</p>
<p>A classic case of a git commit message that'll be rejected:<pre>Fixes #123; refs #124</pre>
</p>

<h3><a class="toc-backref" id="commit-message-additional-considerations" href="#commit-message-additional-considerations">Additional considerations</a></h3><ol class="simple"><li><p>All changes introduced by the commit (diff lines) must be related to the subject of the commit.</p>
<p><em>Tip:</em> Never commit everything as is using <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">commit</span> <span class="option">-a</span></span></tt>, but review your changes carefully with <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">add</span> <span class="option">-p</span></span></tt>.</p>
</li>
<li><p>Changes should not introduce any trailing whitespace.</p>
<p>Always check your changes for whitespace errors using <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">diff</span> <span class="option">--check</span></span></tt> or add the following <tt class="docutils literal"><span class="pre">pre-commit</span></tt> hook:</p>
<pre class="listing"><span class="Comment">#!/bin/sh</span>
<span class="program">git</span> <span class="option">diff</span> <span class="option">--check</span> <span class="option">--cached</span> <span class="Operator">||</span> <span class="program">exit</span> <span class="option">$?</span></pre></li>
<li><p>Commits should be always be rebased against devel</p>
<p>e.g.: use <tt class="docutils literal"><span class="pre"><span class="program">git</span> <span class="option">pull</span> <span class="option">--rebase</span> <span class="option">origin</span> <span class="option">devel</span></span></tt>. This is to avoid messing up git history.</p>
</li>
<li>Do not mix pure formatting changes with other code changes, create separate PRs</li>
</ol>

<h2><a class="toc-backref" id="anatomy-of-a-pull-request-continuous-integration-ci" href="#anatomy-of-a-pull-request-continuous-integration-ci">Continuous Integration (CI)</a></h2><ol class="simple"><li>Continuous Integration is by default run on every push in a PR; this clogs the CI pipeline and affects other PR's; if you don't need it (e.g. for WIP or documentation only changes), add <tt class="docutils literal"><span class="pre">[skip ci]</span></tt> to your commit message title. This convention is supported by our GitHub Actions pipelines (using custom logic, which should complete in &lt; 1mn).</li>
<li>Consider enabling CI (GitHub Actions and builds.sr.ht) in your own  NimSkull fork, and waiting for CI to be green in that fork (fixing bugs as needed) before opening your PR in the original  NimSkull repo, so as to reduce CI congestion. Same applies for updates on a PR: you can test commits on a separate private branch before updating the main PR.</li>
</ol>

<h3><a class="toc-backref" id="continuous-integration-ci-debugging-ci-failures-flaky-tests-etc" href="#continuous-integration-ci-debugging-ci-failures-flaky-tests-etc">Debugging CI failures, flaky tests, etc</a></h3><ol class="simple"><li>First check the CI logs and search for <tt class="docutils literal"><span class="pre"><span class="Identifier">FAIL</span></span></tt> to find why CI failed; if the failure seems related to your PR, try to fix the code instead of restarting CI.</li>
<li>If CI failure seems unrelated to your PR, it could be caused by a flaky test. File a bug for it if it isn't already reported. A PR push (or opening/closing PR) will re-trigger all CI jobs (even successful ones, which can be wasteful). Instead, follow these instructions to only restart the jobs that failed:<ul class="simple"><li>GitHub actions: under &quot;Checks&quot; tab, click &quot;Re-run jobs&quot; in the right.</li>
</ul>
</li>
</ol>
<p>For reproducible tests (to reproduce an environment more similar to the one run by Continuous Integration on GitHub Actions pipelines), you may want to disable your local configuration (e.g. in <tt class="docutils literal"><span class="pre">~/.config/nim/nim.cfg</span></tt>) which may affect some tests; this can also be achieved by using <tt class="docutils literal"><span class="pre"><span class="program">export</span> <span class="option">XDG_CONFIG_HOME=pathtoAlternateConfig</span></span></tt> before running <tt class="docutils literal"><span class="pre"><span class="program">./koch.py</span></span></tt> commands.</p>

<h1><a class="toc-backref" id="change-specific-guidance" href="#change-specific-guidance">Change Specific Guidance</a></h1>
<h2><a class="toc-backref" id="change-specific-guidance-breaking-changes" href="#change-specific-guidance-breaking-changes">&quot;Breaking&quot; Changes</a></h2><p> NimSkull the language and standard library are unstable, the only thing that needs to work is the boostrap process and the VS Code Extension written and used by Saem and other devs. If a change would break bootstrapping, then instead of a rename you need to deprecate the old name and introduce a new one:</p>
<pre class="listing"><span class="Comment"># for routines (proc/template/macro/iterator) and types:</span>
<span class="Keyword">proc</span> <span class="Identifier">oldProc</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">,</span> <span class="Identifier">b</span><span class="Punctuation">:</span> <span class="Identifier">float</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">bool</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Punctuation">:</span>
    <span class="StringLit">&quot;deprecated since v1.2.3; use `newImpl: string -&gt; int` instead&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">discard</span>

<span class="Comment"># for (const/var/let/fields) the msg is not yet supported:</span>
<span class="Keyword">const</span> <span class="Identifier">Foo</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Operator">.</span><span class="Punctuation">}</span>  <span class="Operator">=</span> <span class="DecNumber">1</span>

<span class="Comment"># for enum types, you can deprecate the type or some elements</span>
<span class="Comment"># (likewise with object types and their fields):</span>
<span class="Keyword">type</span> <span class="Identifier">Bar</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="Operator">=</span> <span class="Keyword">enum</span> <span class="Identifier">bar0</span><span class="Punctuation">,</span> <span class="Identifier">bar1</span>
<span class="Keyword">type</span> <span class="Identifier">Barz</span>  <span class="Operator">=</span> <span class="Keyword">enum</span> <span class="Identifier">baz0</span><span class="Punctuation">,</span> <span class="Identifier">baz1</span> <span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">deprecated</span><span class="Operator">.</span><span class="Punctuation">}</span><span class="Punctuation">,</span> <span class="Identifier">baz2</span></pre><p>See also <a class="reference external" href="manual.html#pragmas-deprecated-pragma">Deprecated</a> pragma in the manual.</p>

<h2><a class="toc-backref" id="change-specific-guidance-compilerslashlanguage-spec-bugfixes" href="#change-specific-guidance-compilerslashlanguage-spec-bugfixes">Compiler/language spec bugfixes</a></h2><p>This can even be applied to compiler &quot;bugfixes&quot;: If the compiler should have been &quot;pickier&quot; in its handling of <tt class="docutils literal"><span class="pre"><span class="Identifier">typedesc</span></span></tt>:</p>
<p>While in regular discussion with  NimSkull core devs:</p>
<ul class="simple"><li>Spec out how <tt class="docutils literal"><span class="pre"><span class="Identifier">typedesc</span></span></tt> should really work and also spec out the cases where it should not be allowed!</li>
<li>Deprecate <tt class="docutils literal"><span class="pre"><span class="Identifier">typedesc</span></span></tt> and name the new metatype something new like <tt class="docutils literal"><span class="pre"><span class="Identifier">typeArg</span></span></tt>.</li>
<li>Implement the spec.</li>
</ul>

<h2><a class="toc-backref" id="change-specific-guidance-evolving-the-stdlib" href="#change-specific-guidance-evolving-the-stdlib">Evolving the stdlib</a></h2><p>Maybe in the future the compiler itself can depend on external packages but for the time being, we strive to have zero dependencies in the compiler as the compiler is the root of the bootstrapping process.</p>

<h1><a class="toc-backref" id="testing" href="#testing">Testing</a></h1>
<h2><a class="toc-backref" id="testing-writing-tests" href="#testing-writing-tests">Writing Tests</a></h2><p>Tests are located in <tt class="docutils literal"><span class="pre">tests/</span></tt> (e.g.: <tt class="docutils literal"><span class="pre">tests/destructor/tdestructor3.nim</span></tt>).</p>
<p>Each test has its own file. All test files are prefixed with <tt class="docutils literal"><span class="pre"><span class="Identifier">t</span></span></tt>. If you want to create a file for import into another test only, use the prefix <tt class="docutils literal"><span class="pre"><span class="Identifier">m</span></span></tt>. For the standard library, each module (anything under <tt class="docutils literal"><span class="pre">lib/</span></tt>, e.g. <tt class="docutils literal"><span class="pre">lib/pure/os.nim</span></tt>) should have a corresponding separate tests folder and files.</p>
<p>At the beginning of every test file is the test specification description, eg:</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
description: &quot;parameter type mismatch results in an error&quot;
errormsg: &quot;type mismatch: got (PTest)&quot;
&quot;&quot;&quot;</span>

<span class="Keyword">type</span>
  <span class="Identifier">PTest</span> <span class="Operator">=</span> <span class="Keyword">ref</span> <span class="Keyword">object</span>

<span class="Keyword">proc</span> <span class="Identifier">test</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">PTest</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Keyword">nil</span>

<span class="Keyword">var</span> <span class="Identifier">buf</span><span class="Punctuation">:</span> <span class="Identifier">PTest</span>
<span class="Identifier">buf</span><span class="Operator">.</span><span class="Identifier">test</span><span class="Punctuation">(</span><span class="Punctuation">)</span></pre><p>For a full spec, see here: <tt class="docutils literal"><span class="pre">testament/specs.nim</span></tt></p>
<p>Each test should be in a separate <tt class="docutils literal"><span class="pre"><span class="Keyword">block</span><span class="Punctuation">:</span></span></tt> statement, such that each has its own scope. Use boolean conditions and <tt class="docutils literal"><span class="pre"><span class="Identifier">doAssert</span></span></tt> for the testing by itself, don't rely on echo statements or similar; in particular, avoid things like <tt class="docutils literal"><span class="pre"><span class="Identifier">echo</span> <span class="StringLit">&quot;done&quot;</span></span></tt>.</p>
<p>Some legacy code use these conventions which are to be avoided:</p>
<ul class="simple"><li>using a <tt class="docutils literal"><span class="pre"><span class="Keyword">when</span> <span class="Identifier">isMainModule</span><span class="Punctuation">:</span></span></tt> block in the source file</li>
<li>using <tt class="docutils literal"><span class="pre"><span class="Identifier">unittest</span><span class="Operator">.</span><span class="Identifier">suite</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">unittest</span><span class="Operator">.</span><span class="Identifier">test</span></span></tt> routines</li>
</ul>
<p>Please replace this if you're making changes associated to the module.</p>
<p>Sample standard library test:</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
&quot;&quot;&quot;</span>

<span class="Keyword">block</span> <span class="Identifier">foo_multiplies_by_10</span><span class="Punctuation">:</span>
  <span class="Identifier">doAssert</span> <span class="Identifier">foo</span><span class="Punctuation">(</span><span class="DecNumber">1</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="DecNumber">10</span>

<span class="Keyword">block</span> <span class="Identifier">int_constant_expression_evaluation</span><span class="Punctuation">:</span>
  <span class="Comment">## encountered a regressions with integer constant expression evaluation</span>
  <span class="Comment">## see bug #1234</span>
  <span class="Keyword">static</span><span class="Punctuation">:</span> <span class="Identifier">doAssert</span> <span class="DecNumber">1</span><span class="Operator">+</span><span class="DecNumber">1</span> <span class="Operator">==</span> <span class="DecNumber">2</span><span class="Punctuation">,</span> <span class="StringLit">&quot;int constant expression evaluation regression&quot;</span>

<span class="Keyword">block</span> <span class="Identifier">structural_comparison_of_nested_seqs</span><span class="Punctuation">:</span>
  <span class="Keyword">var</span> <span class="Identifier">seq2D</span> <span class="Operator">=</span> <span class="Identifier">newSeqWith</span><span class="Punctuation">(</span><span class="DecNumber">4</span><span class="Punctuation">,</span> <span class="Identifier">newSeq</span><span class="Punctuation">[</span><span class="Identifier">bool</span><span class="Punctuation">]</span><span class="Punctuation">(</span><span class="DecNumber">2</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
  <span class="Identifier">seq2D</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">true</span>
  <span class="Identifier">seq2D</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">true</span>
  <span class="Identifier">seq2D</span><span class="Punctuation">[</span><span class="DecNumber">0</span><span class="Punctuation">]</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Identifier">true</span>
  <span class="Identifier">doAssert</span> <span class="Identifier">seq2D</span> <span class="Operator">==</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">true</span><span class="Punctuation">,</span> <span class="Identifier">true</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">true</span><span class="Punctuation">,</span> <span class="Identifier">false</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
                      <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">false</span><span class="Punctuation">,</span> <span class="Identifier">false</span><span class="Punctuation">]</span><span class="Punctuation">,</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Identifier">false</span><span class="Punctuation">,</span> <span class="Identifier">false</span><span class="Punctuation">]</span><span class="Punctuation">]</span>
  <span class="Comment"># doAssert with `not` can now be done as follows:</span>
  <span class="Identifier">doAssert</span> <span class="Keyword">not</span> <span class="Punctuation">(</span><span class="DecNumber">1</span> <span class="Operator">==</span> <span class="DecNumber">2</span><span class="Punctuation">)</span></pre><p>Rationale for using a separate test file instead of <tt class="docutils literal"><span class="pre"><span class="Keyword">when</span> <span class="Identifier">isMainModule</span><span class="Punctuation">:</span></span></tt> block:</p>
<ul class="simple"><li>allows custom compiler flags or testing options (see details below)</li>
<li>faster CI since they can be joined in <tt class="docutils literal"><span class="pre">megatest</span></tt> (combined into a single test)</li>
<li>avoids making the parser do un-necessary work when a source file is merely imported</li>
<li>avoids mixing source and test code when reporting line of code statistics or code coverage</li>
</ul>

<h2><a class="toc-backref" id="testing-running-tests" href="#testing-running-tests">Running Tests</a></h2><p>To execute tests use <tt class="docutils literal"><span class="pre"><span class="Operator">./</span><span class="Identifier">koch</span><span class="Operator">.</span><span class="Identifier">py</span></span></tt>:</p>
<pre class="listing"><span class="program">./koch.py</span> <span class="option">test</span> <span class="option">all</span> <span class="Comment"># run all available tests</span></pre><p>Run a single category of tests. A category are the immediate subdirectories under the directory <tt class="docutils literal"><span class="pre">tests/</span></tt>:</p>
<pre class="listing"><span class="program">./koch.py</span> <span class="option">tests</span> <span class="option">c</span> <span class="option">stdlib</span> <span class="Comment"># runs tests under tests/stdlib</span></pre><p>or run a single tests:</p>
<pre class="listing"><span class="program">./koch.py</span> <span class="option">test</span> <span class="option">run</span> <span class="Identifier">tests/stdlib/tos.nim</span></pre><p>For a faster test cycle, rerun failing tests only:</p>
<pre class="listing"><span class="program">./koch.py</span> <span class="option">test</span> <span class="option">--retry</span></pre>
<h2><a class="toc-backref" id="testing-comparing-tests" href="#testing-comparing-tests">Comparing tests</a></h2><p>Test failures can be grepped using <tt class="docutils literal"><span class="pre">Failure:</span></tt>.</p>
<p>The tester can compare two test runs. First, you need to create a reference test. You'll also need to the commit id, because that's what the tester needs to know in order to compare the two.</p>
<pre class="listing"><span class="program">git</span> <span class="option">checkout</span> <span class="option">devel</span>
<span class="Identifier">DEVEL_COMMIT=$</span><span class="Operator">(</span><span class="program">git</span> <span class="option">rev-parse</span> <span class="option">HEAD</span><span class="Operator">)</span>
<span class="program">./koch.py</span> <span class="option">tests</span></pre><p>Then switch over to your changes and run the tester again.</p>
<pre class="listing"><span class="program">git</span> <span class="option">checkout</span> <span class="option">your-changes</span>
<span class="program">./koch.py</span> <span class="option">tests</span></pre><p>Then you can ask the tester to create a <tt class="docutils literal"><span class="pre">testresults.html</span></tt> which will tell you if any new tests passed/failed.</p>
<pre class="listing"><span class="program">./koch.py</span> <span class="option">tests</span> <span class="option">--print</span> <span class="option">html</span> <span class="option">$DEVEL_COMMIT</span></pre>
<h2><a class="toc-backref" id="testing-useful-test-patterns" href="#testing-useful-test-patterns">Useful Test Patterns</a></h2><p>If you're new to testing easiest way to start is by looking in the <tt class="docutils literal"><span class="pre"><span class="Identifier">tests</span><span class="Operator">/</span><span class="Identifier">lang</span></span></tt> directory. Compiler tests are executed using <tt class="docutils literal"><span class="pre"><span class="Identifier">testament</span></span></tt>, see its docs for further details.</p>
<p>Here is a short list of patterns for testing specific cases for which examples might be hard to find unless you know what to look for:</p>
<ul class="simple"><li><em>Test for specific values</em>: Either use <tt class="docutils literal"><span class="pre"><span class="Identifier">doAssert</span> <span class="Operator">&lt;</span><span class="Identifier">given</span><span class="Operator">&gt;</span> <span class="Operator">==</span> <span class="Operator">&lt;</span><span class="Identifier">expected</span><span class="Operator">&gt;</span></span></tt> or <tt class="docutils literal"><span class="pre"><span class="Identifier">check</span></span></tt> from <tt class="docutils literal"><span class="pre"><span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">unittest</span></span></tt></li>
<li><em>Test that is supposed to fail</em>: There are several different ways a test can &quot;fail&quot;:<ul class="simple"><li><em>Known issue that should be fixed later</em>: Write a test for code as it <em>should</em> work and annotate the specification using <tt class="docutils literal"><span class="pre"><span class="Identifier">knownIssue</span></span></tt> with provided explanation.</li>
<li><em>Exception must be thrown</em>: Either use <tt class="docutils literal"><span class="pre"><span class="Keyword">try</span> <span class="Operator">...</span> <span class="Keyword">except</span></span></tt> construct and check for type/field of the exception captured or use <tt class="docutils literal"><span class="pre"><span class="Identifier">expect</span></span></tt> macro from <tt class="docutils literal"><span class="pre"><span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">unittest</span></span></tt></li>
<li><em>Specific compilation error</em>: Use <tt class="docutils literal"><span class="pre"><span class="Identifier">errormsg</span><span class="Punctuation">:</span> <span class="StringLit">&quot;&lt;error&gt;&quot;</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">line</span><span class="Punctuation">:</span> <span class="Operator">&lt;</span><span class="Identifier">line</span><span class="Operator">&gt;</span></span></tt> fields in the specification.</li>
</ul>
</li>
</ul>
<div class="admonition admonition-info"><span class="admonition-info-text"><b>Tip:</b></span>
<p>If the test already uses <tt class="docutils literal"><span class="pre"><span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">unittest</span></span></tt> or you plan to rewrite it to use the library you should prefer <tt class="docutils literal"><span class="pre"><span class="Identifier">check</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">expect</span></span></tt> macros, otherwise you can stick to <tt class="docutils literal"><span class="pre"><span class="Keyword">try</span><span class="Operator">..</span><span class="Keyword">except</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="Identifier">doAssert</span></span></tt>.</p>
<p>Another reason why might opt to use simpler solution is reducing number of dependencies for the test -- if you want your test to include as little additional details as possible.</p>
</div>

<h1><a class="toc-backref" id="documenting" href="#documenting">Documenting</a></h1><div class="admonition admonition-info"><span class="admonition-info-text"><b>Tip:</b></span>
Documentation for a module, including private members, can be viewed using <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span> <span class="option">--docInternal</span> <span class="Identifier">foo.nim</span></span></tt>.</div>

<h2><a class="toc-backref" id="documenting-general-guidelines" href="#documenting-general-guidelines">General Guidelines</a></h2><ul class="simple"><li>Authors should document anything that is exported; documentation for private procs can be useful too (visible via <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span> <span class="option">--docInternal</span> <span class="Identifier">foo.nim</span></span></tt>).</li>
<li>Within documentation, a period (<tt class="docutils literal"><span class="pre"><span class="Operator">.</span></span></tt>) should follow each sentence (or sentence fragment) in a comment block. The documentation may be limited to one sentence fragment, but if multiple sentences are within the documentation, each sentence after the first should be complete and in present tense.</li>
<li>Documentation is parsed as a custom ReStructuredText (RST) with partial markdown support.</li>
<li>In nim sources, prefer single backticks to double backticks since it's simpler and <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span></span></tt> supports it. Likewise with <tt class="docutils literal"><span class="pre">rst</span></tt> files: <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">rst2html</span></span></tt> will render those as monospace, and adding <tt class="docutils literal"><span class="pre">.. default-role:: code</span></tt> to an <tt class="docutils literal"><span class="pre">rst</span></tt> file will also make those render as monospace when rendered directly in tools such as github.</li>
</ul>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">someproc</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">s</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">,</span> <span class="Identifier">foo</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment">## Use single backticks for inline code, e.g.: `s` or `someExpr(true)`.</span>
  <span class="Comment">## Use a backlash to follow with alphanumeric char: `int8`\s are great.</span></pre>
<h2><a class="toc-backref" id="documenting-documentation-style-guidelines" href="#documenting-documentation-style-guidelines">Documentation Style Guidelines</a></h2><p>When you specify an <em>RST role</em> (highlighting/interpretation marker) do it in the postfix form for uniformity, that is after `text in backticks`. For example an <tt class="docutils literal"><span class="pre">:idx:</span></tt> role for referencing a topic (&quot;SQLite&quot; in the example below) from <a class="reference external" href="https://nim-works.github.io/nimskull/theindex.html">NimSkull Index</a> can be used in doc comment this way:</p>
<pre class="listing"><span class="Comment">## A higher level `SQLite`:idx: database wrapper.</span></pre><p>Inline monospaced text can be input using `single backticks` or ``double backticks``. The former are syntactically highlighted, the latter are not. To avoid accidental highlighting follow this rule in <tt class="docutils literal"><span class="pre">*.nim</span></tt> files:</p>
<ul class="simple"><li><p>use single backticks for fragments of code in  NimSkull and other programming languages, including identifiers, in <tt class="docutils literal"><span class="pre">*.nim</span></tt> files.</p>
<p>For languages other than  NimSkull add a role after final backtick, e.g. for C inline highlighting:<pre>`#include &lt;stdio.h&gt;`:c:</pre>
</p>
<p>For a currently unsupported language add the <tt class="docutils literal"><span class="pre"><span class="Punctuation">:</span><span class="Identifier">code</span><span class="Punctuation">:</span></span></tt> role, like for SQL in this example:<pre>`SELECT * FROM &lt;table_name&gt;;`:code:</pre>
</p>
<p>Highlight shell commands by <tt class="docutils literal"><span class="pre">:cmd:</span></tt> role; for command line options use <tt class="docutils literal"><span class="pre">:option:</span></tt> role, e.g.: `--docInternal`:option:.</p>
</li>
<li>prefer double backticks otherwise:<ul class="simple"><li>for file names: ``os.nim``</li>
<li>for fragments of strings <strong>not</strong> enclosed by <tt class="docutils literal"><span class="pre"><span class="StringLit">&quot;</span></span></tt> and <tt class="docutils literal"><span class="pre"><span class="StringLit">&quot;</span></span></tt> and not related to code, e.g. text of compiler messages</li>
<li>also when code ends with a standalone <tt class="docutils literal"><span class="pre">\</span></tt> (otherwise a combination of <tt class="docutils literal"><span class="pre">\</span></tt> and a final ` would get escaped)</li>
</ul>
</li>
</ul>
<div class="admonition admonition-info"><span class="admonition-info-text"><b>Note:</b></span>
<p><tt class="docutils literal"><span class="pre">*.rst</span></tt> files have <tt class="docutils literal"><span class="pre">:literal:</span></tt> as their default role. So for them the rule above is only applicable if the <tt class="docutils literal"><span class="pre">:nim:</span></tt> role is set up manually as the default <sup><strong><a class="reference internal" href="#footnotesym-1">[*]</a></strong></sup>:<pre>.. role:: nim(code)
   :language: nim
.. default-role:: nim</pre>
</p>
<p>The first 2 lines are for other RST implementations, including Github one.</p>
<hr class="footnote"><div class="footnote-group">
<div id="footnotesym-1"><div class="footnote-label"><sup><strong><a href="#footnotesym-1">[*]</a></strong></sup></div> &ensp; this is fulfilled when <tt class="docutils literal"><span class="pre">doc/rstcommon.rst</span></tt> is included.
</div>
</div>
</div>
<p>Runnable code examples are also encouraged, to show typical behavior with a few test cases (typically 1 to 3 <tt class="docutils literal"><span class="pre"><span class="Identifier">assert</span></span></tt> statements, depending on complexity). These <tt class="docutils literal"><span class="pre"><span class="Identifier">runnableExamples</span></span></tt> are automatically run by <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span> <span class="Identifier">mymodule.nim</span></span></tt> as well as <tt class="docutils literal"><span class="pre"><span class="program">testament</span></span></tt> and guarantee they stay in sync.</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">addBar</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">a</span><span class="Punctuation">:</span> <span class="Identifier">string</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## Adds &quot;Bar&quot; to `a`.</span>
  <span class="Identifier">runnableExamples</span><span class="Punctuation">:</span>
    <span class="Identifier">assert</span> <span class="StringLit">&quot;baz&quot;</span><span class="Operator">.</span><span class="Identifier">addBar</span> <span class="Operator">==</span> <span class="StringLit">&quot;bazBar&quot;</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">a</span> <span class="Operator">&amp;</span> <span class="StringLit">&quot;Bar&quot;</span></pre><p>See <a class="reference external" href="os.html#parentDir,string">parentDir</a> example.</p>
<p>The RestructuredText  NimSkull uses has a special syntax for including code snippets embedded in documentation; these are not run by <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span></span></tt> and therefore are not guaranteed to stay in sync, so <tt class="docutils literal"><span class="pre"><span class="Identifier">runnableExamples</span></span></tt> is almost always preferred:</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">someProc</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## Returns &quot;something&quot;</span>
  <span class="Comment">##</span>
  <span class="Comment">## .. code-block::</span>
  <span class="Comment">##  echo someProc() # &quot;something&quot;</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="StringLit">&quot;something&quot;</span> <span class="Comment"># single-hash comments do not produce documentation</span></pre><p>The <tt class="docutils literal"><span class="pre">.. code-block:: nim</span></tt> followed by a newline and an indentation instructs the <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span></span></tt> command to produce syntax-highlighted example code with the documentation (<tt class="docutils literal"><span class="pre">.. code-block::</span></tt> is sufficient from inside a nim module).</p>

<h3><a class="toc-backref" id="documentation-style-guidelines-moduleminuslevel-documentation" href="#documentation-style-guidelines-moduleminuslevel-documentation">Module-level documentation</a></h3><p>Documentation of a module is placed at the top of the module itself. Each line of documentation begins with double hashes (<tt class="docutils literal"><span class="pre"><span class="Comment">##</span></span></tt>). Sometimes <tt class="docutils literal"><span class="pre"><span class="LongComment">##[ multiline docs containing code ]##</span></span></tt> is preferable, see <tt class="docutils literal"><span class="pre">lib/pure/times.nim</span></tt>. Code samples are encouraged, and should follow the general RST syntax:</p>
<pre class="listing"><span class="Comment">## The `universe` module computes the answer to life, the universe, and</span>
<span class="Comment">## everything.</span>
<span class="Comment">##</span>
<span class="Comment">## .. code-block::</span>
<span class="Comment">##  doAssert computeAnswerString() == 42</span></pre><p>Within this top-level comment, you can indicate the authorship and copyright of the code, which will be featured in the produced documentation.</p>
<pre class="listing"><span class="Comment">## This is the best module ever. It provides answers to everything!</span>
<span class="Comment">##</span>
<span class="Comment">## :Author: Steve McQueen</span>
<span class="Comment">## :Copyright: 1965</span>
<span class="Comment">##</span></pre><p>Leave a space between the last line of top-level documentation and the beginning of  NimSkull code (the imports, etc.).</p>

<h3><a class="toc-backref" id="documentation-style-guidelines-procs-templates-macros-converters-and-iterators" href="#documentation-style-guidelines-procs-templates-macros-converters-and-iterators">Procs, Templates, Macros, Converters, and Iterators</a></h3><p>When contributing new procs or editing existing procs without documentation, please document them, this is a must for stdlib public API. Even private procs benefit from documentation.</p>
<p>Documentation begins on the line following the <tt class="docutils literal"><span class="pre"><span class="Keyword">proc</span></span></tt> definition, and each line prefixed with <tt class="docutils literal"><span class="pre"><span class="Comment">##</span></span></tt>.</p>
<p>When forward declaration is used, the documentation should be included with the first appearance of the proc.</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span>
  <span class="Comment">## Put documentation here</span>
<span class="Keyword">proc</span> <span class="Identifier">nothing</span><span class="Punctuation">(</span><span class="Punctuation">)</span> <span class="Operator">=</span> <span class="Keyword">discard</span>
<span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## ignore this</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;hello&quot;</span></pre><p>The preferred documentation style is to begin with a capital letter and use the third-person singular. That is, between:</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## Returns &quot;hello&quot;</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="StringLit">&quot;hello&quot;</span></pre><p>or</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">hello</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">string</span> <span class="Operator">=</span>
  <span class="Comment">## say hello</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="StringLit">&quot;hello&quot;</span></pre><p>the first is preferred.</p>
<p>The documentation of a procedure should begin with a capital letter and should be in present tense. Variables referenced in the documentation should be surrounded by single tick marks:</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">example1</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">:</span> <span class="Identifier">int</span><span class="Punctuation">)</span> <span class="Operator">=</span>
  <span class="Comment">## Prints the value of `x`.</span>
  <span class="Identifier">echo</span> <span class="Identifier">x</span></pre><p>Whenever an example of usage would be helpful to the user, you should include one within the documentation in RST format as below.</p>
<pre class="listing"><span class="Keyword">proc</span> <span class="Identifier">addThree</span><span class="Operator">*</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">,</span> <span class="Identifier">y</span><span class="Punctuation">,</span> <span class="Identifier">z</span><span class="Punctuation">:</span> <span class="Identifier">int8</span><span class="Punctuation">)</span><span class="Punctuation">:</span> <span class="Identifier">int</span> <span class="Operator">=</span>
  <span class="Comment">## Adds three `int8` values, treating them as unsigned and</span>
  <span class="Comment">## truncating the result.</span>
  <span class="Comment">##</span>
  <span class="Comment">## .. code-block::</span>
  <span class="Comment">##  # things that aren't suitable for a `runnableExamples` go in code-block:</span>
  <span class="Comment">##  echo execCmdEx(&quot;git pull&quot;)</span>
  <span class="Comment">##  drawOnScreen()</span>
  <span class="Identifier">runnableExamples</span><span class="Punctuation">:</span>
    <span class="Comment"># `runnableExamples` is usually preferred to ``code-block``, when possible.</span>
    <span class="Identifier">doAssert</span> <span class="Identifier">addThree</span><span class="Punctuation">(</span><span class="DecNumber">3</span><span class="Punctuation">,</span> <span class="DecNumber">125</span><span class="Punctuation">,</span> <span class="DecNumber">6</span><span class="Punctuation">)</span> <span class="Operator">==</span> <span class="Operator">-</span><span class="DecNumber">122</span>
  <span class="Identifier">result</span> <span class="Operator">=</span> <span class="Identifier">x</span> <span class="Operator">+%</span> <span class="Identifier">y</span> <span class="Operator">+%</span> <span class="Identifier">z</span></pre><p>The command <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span></span></tt> will then correctly syntax highlight the  NimSkull code within the documentation.</p>

<h3><a class="toc-backref" id="documentation-style-guidelines-types" href="#documentation-style-guidelines-types">Types</a></h3><p>Exported types should also be documented. This documentation can also contain code samples, but those are better placed with the functions to which they refer.</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Identifier">NamedQueue</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Keyword">object</span> <span class="Comment">## Provides a linked data structure with names</span>
                          <span class="Comment">## throughout. It is named for convenience. I'm making</span>
                          <span class="Comment">## this comment long to show how you can, too.</span>
    <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span> <span class="Comment">## The name of the item</span>
    <span class="Identifier">val</span><span class="Operator">*:</span> <span class="Identifier">T</span> <span class="Comment">## Its value</span>
    <span class="Identifier">next</span><span class="Operator">*:</span> <span class="Keyword">ref</span> <span class="Identifier">NamedQueue</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Comment">## The next item in the queue</span></pre><p>You have some flexibility when placing the documentation:</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Identifier">NamedQueue</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Keyword">object</span>
    <span class="Comment">## Provides a linked data structure with names</span>
    <span class="Comment">## throughout. It is named for convenience. I'm making</span>
    <span class="Comment">## this comment long to show how you can, too.</span>
    <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span>            <span class="Comment">## The name of the item</span>
    <span class="Identifier">val</span><span class="Operator">*:</span> <span class="Identifier">T</span>                  <span class="Comment">## Its value</span>
    <span class="Identifier">next</span><span class="Operator">*:</span> <span class="Keyword">ref</span> <span class="Identifier">NamedQueue</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Comment">## The next item in the queue</span></pre><p>Make sure to place the documentation beside or within the object.</p>
<pre class="listing"><span class="Keyword">type</span>
  <span class="Comment">## Bad: this documentation disappears because it annotates the `type` keyword</span>
  <span class="Comment">## above, not `NamedQueue`.</span>
  <span class="Identifier">NamedQueue</span><span class="Operator">*</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Operator">=</span> <span class="Keyword">object</span>
    <span class="Identifier">name</span><span class="Operator">*:</span> <span class="Identifier">string</span>            <span class="Comment">## This becomes the main documentation for the</span>
                             <span class="Comment">## object, which is not what we want.</span>
    <span class="Identifier">val</span><span class="Operator">*:</span> <span class="Identifier">T</span>                  <span class="Comment">## Its value</span>
    <span class="Identifier">next</span><span class="Operator">*:</span> <span class="Keyword">ref</span> <span class="Identifier">NamedQueue</span><span class="Punctuation">[</span><span class="Identifier">T</span><span class="Punctuation">]</span> <span class="Comment">## The next item in the queue</span></pre>
<h3><a class="toc-backref" id="documentation-style-guidelines-var-let-and-const" href="#documentation-style-guidelines-var-let-and-const">Var, Let, and Const</a></h3><p>When declaring module-wide constants and values, documentation is encouraged. The placement of doc comments is similar to the <tt class="docutils literal"><span class="pre"><span class="Keyword">type</span></span></tt> sections.</p>
<pre class="listing"><span class="Keyword">const</span>
  <span class="Identifier">X</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="DecNumber">42</span> <span class="Comment">## An awesome number.</span>
  <span class="Identifier">SpreadArray</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Punctuation">[</span>
    <span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">,</span><span class="DecNumber">2</span><span class="Punctuation">,</span><span class="DecNumber">3</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
    <span class="Punctuation">[</span><span class="DecNumber">2</span><span class="Punctuation">,</span><span class="DecNumber">3</span><span class="Punctuation">,</span><span class="DecNumber">1</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
    <span class="Punctuation">[</span><span class="DecNumber">3</span><span class="Punctuation">,</span><span class="DecNumber">1</span><span class="Punctuation">,</span><span class="DecNumber">2</span><span class="Punctuation">]</span><span class="Punctuation">,</span>
  <span class="Punctuation">]</span> <span class="Comment">## Doc comment for `SpreadArray`.</span></pre><p>Placement of comments in other areas is usually allowed, but will not become part of the documentation output and should therefore be prefaced by a single hash (<tt class="docutils literal"><span class="pre"><span class="Comment">#</span></span></tt>).</p>
<pre class="listing"><span class="Keyword">const</span>
  <span class="Identifier">BadMathVals</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Punctuation">[</span>
    <span class="FloatNumber">3.14</span><span class="Punctuation">,</span> <span class="Comment"># pi</span>
    <span class="FloatNumber">2.72</span><span class="Punctuation">,</span> <span class="Comment"># e</span>
    <span class="FloatNumber">0.58</span><span class="Punctuation">,</span> <span class="Comment"># gamma</span>
  <span class="Punctuation">]</span> <span class="Comment">## A bunch of badly rounded values.</span></pre><p> NimSkull supports Unicode in comments, so the above can be replaced with the following:</p>
<pre class="listing"><span class="Keyword">const</span>
  <span class="Identifier">BadMathVals</span><span class="Operator">*</span> <span class="Operator">=</span> <span class="Punctuation">[</span>
    <span class="FloatNumber">3.14</span><span class="Punctuation">,</span> <span class="Comment"># π</span>
    <span class="FloatNumber">2.72</span><span class="Punctuation">,</span> <span class="Comment"># e</span>
    <span class="FloatNumber">0.58</span><span class="Punctuation">,</span> <span class="Comment"># γ</span>
  <span class="Punctuation">]</span> <span class="Comment">## A bunch of badly rounded values.</span></pre>
<h1><a class="toc-backref" id="starter-contribution-areas" href="#starter-contribution-areas">Starter Contribution Areas</a></h1>
<h2><a class="toc-backref" id="starter-contribution-areas-writing-or-improving-tests" href="#starter-contribution-areas-writing-or-improving-tests">Writing or improving tests</a></h2><p>We recommend starting with tests, as it aligns with our key principle of  sustainability, and the goal of language specification as tests. Building a comprehensive specification is one of the main goals of  nimskull, you can learn more about the spec structure <a class="reference external" href="spec.html#">here</a>.</p>
<p>Progress of the test suite improvements is tracked in the github <a class="reference external" href="https://github.com/nim-works/nimskull/projects/2">project</a>.</p>
<p>Types of testing approaches, in order of preference. If they're marked as deprecated these are to be converted where possible and not used going forward:</p>
<ol class="simple"><li>separate test files, e.g.: <tt class="docutils literal"><span class="pre">tests/stdlib/tos.nim</span></tt>. In  NimSkull repo, <tt class="docutils literal"><span class="pre"><span class="program">testament</span></span></tt> (see below) runs all <tt class="docutils literal"><span class="pre">$nim/tests/*/t*.nim</span></tt> test files<ul class="simple"><li>Usage of <tt class="docutils literal"><span class="pre">echo</span></tt> in tests is discouraged and should be replaced with <tt class="docutils literal"><span class="pre">doAssert</span></tt> when possible. Assertion-based tests are easier to read (condition for test pass is written in the test itself) and move around when needed (for running single piece of code for debugging, or moving whole test into another file)</li>
<li>Don't forget to add <tt class="docutils literal"><span class="pre"><span class="Identifier">description</span><span class="Punctuation">:</span></span></tt> field to the testament specification</li>
<li>Also comment on the test's parts. Well-written test with careful explanation of what is going on, or why particular element is tested in this manner can serve as a powerful teaching tool.</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre"><span class="Identifier">runnableExamples</span></span></tt> documentation comment tests, ran by <tt class="docutils literal"><span class="pre"><span class="program">nim</span> <span class="option">doc</span> <span class="Identifier">mymod.nim</span></span></tt> These end up in documentation and ensure documentation stays in sync with code.</li>
</ol>
<div class="admonition admonition-info"><span class="admonition-info-text"><b>Note:</b></span>
Not all the tests follow the convention here, feel free to update the ones that don't. Always leave the code cleaner than you found it. Usage of deprecated tests styles is almost guaranteed to lead to PR rejection.</div>

<h2><a class="toc-backref" id="starter-contribution-areas-improving-language-specification" href="#starter-contribution-areas-improving-language-specification">Improving Language specification</a></h2><p>In order to have the confidence in the compiler implementation and it's behavior we must provide a comprehensive suite of checks for the compiler behavior. This is a complex undertaking as a whole, but it can be easily split in a smaller contributions.</p>

<h2><a class="toc-backref" id="starter-contribution-areas-cleaning-up-existing-tests" href="#starter-contribution-areas-cleaning-up-existing-tests">Cleaning up Existing Tests</a></h2><p>Original collection of tests in the test suite contained a lot of files that did not conform to the requirements listed above, and should eventually be fixed. A list of known issues that should be fixed includes, but not limited to:</p>
<ul class="simple"><li>Check if test name makes sense - <tt class="docutils literal"><span class="pre"><span class="Identifier">t123123_b</span><span class="Operator">.</span><span class="Identifier">nim</span></span></tt> does not make sense, change it to something matching what is being tested. File names usually refer to the numbers of issues in the original repository.</li>
<li><p>Reduce number of echo-based error testing. If you see direct echo in test consider changing it to the <tt class="docutils literal"><span class="pre"><span class="Identifier">doAssert</span></span></tt> check instead.</p>
<p>Added assertions should replace original sequence of checks with <tt class="docutils literal"><span class="pre"><span class="Identifier">doAssert</span> <span class="Identifier">a</span> <span class="Operator">==</span> <span class="Operator">&lt;</span><span class="Identifier">expected</span><span class="Operator">&gt;</span></span></tt> expression. If original check printed multiple values in sequence (for example in a for loop) you can collect them into a <tt class="docutils literal"><span class="pre"><span class="Identifier">seq</span><span class="Punctuation">[</span><span class="Identifier">string</span><span class="Punctuation">]</span></span></tt> variable and compare using <tt class="docutils literal"><span class="pre"><span class="Operator">==</span></span></tt> later.</p>
</li>
<li><p>Link relevant issues in the test description (<tt class="docutils literal"><span class="pre"><span class="Identifier">description</span></span></tt> field) or in comments.</p>
<p>Huge number of original tests &quot;referred&quot; to issue numbers using file names or highly illegible comments such as <tt class="docutils literal"><span class="pre"><span class="Comment"># XYZ123</span></span></tt> placed at arbitrary locations all over the code. You should replace them with actual <tt class="docutils literal"><span class="pre"><span class="Identifier">url</span></span></tt> links from <a class="reference external" href="https://github.com/nim-lang/Nim/issues">https://github.com/nim-lang/Nim/issues</a> so people can see the context quickly.</p>
</li>
<li>If possible, provide explanation to the test logic. You can use the description of the linked issue as a basis.</li>
<li>Adding labels to existing tests. For guidelines on test label usage and list of existing tags with documentation please see testament documentation <a class="reference external" href="https://nim-works.github.io/nimskull/testament.html#writing-tests-labels">Labels</a> section.</li>
</ul>
</p>
  
  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2023-10-08 00:00:00 UTC</small>
      </div>
    </div>
  </div>
</div>
</body>
</html>
